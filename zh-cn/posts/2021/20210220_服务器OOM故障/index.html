<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用idm下载y2b视频导致服务器内存溢出，内核强制关闭了服务进程。
通过系统日志定位原因，并介绍了服务器维护的几个相关命令。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://wangy325.github.io/zh-cn/posts/2021/20210220_%E6%9C%8D%E5%8A%A1%E5%99%A8OOM%E6%95%85%E9%9A%9C/"><meta property="og:site_name" content="xf&pl"><meta property="og:title" content="一次服务器OOM故障"><meta property="og:description" content="使用idm下载y2b视频导致服务器内存溢出，内核强制关闭了服务进程。
通过系统日志定位原因，并介绍了服务器维护的几个相关命令。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-20T00:00:00+08:00"><meta property="article:modified_time" content="2021-02-20T00:00:00+08:00"><meta property="article:tag" content="Server"><title>一次服务器OOM故障 | xf&amp;pl</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://wangy325.github.io/zh-cn/posts/2021/20210220_%E6%9C%8D%E5%8A%A1%E5%99%A8OOM%E6%95%85%E9%9A%9C/><link rel=stylesheet href=/book.min.21a480c3e6e72098579e2787d343e35263286cda9742462341e6aa278fbea46c.css integrity="sha256-IaSAw+bnIJhXnieH00PjUmMobNqXQkYjQeaqJ4++pGw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/zh-cn.search.min.c2df43b03e7a9ae96b82634fe3204a8b52c807150e1a240387fa9731a83ccbf5.js integrity="sha256-wt9DsD56mulrgmNP4yBKi1LIBxUOGiQDh/qXMag8y/U=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-HHNKR5H8KN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HHNKR5H8KN")}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><div class=navi-bar id=navibar><div id=page-title><h2 class=book-brand><a class="flex align-center" href=/zh-cn/><span>xf&amp;pl</span></a></h2></div><div class=page-navi-col><nav><ul><li><a href=/zh-cn/docs/java/>Java</a></li><li><a href=/zh-cn/docs/design_pattern/>DP</a></li><li class=book-section-flat><a href=/zh-cn/docs/note/>Mooc</a></li><li class=book-section-flat><a href=/zh-cn/docs/snippets/>Snippets</a></li></ul><ul><li><a href=/zh-cn/posts/>Blog</a></li><li><a href=/zh-cn/archive/>Archive</a></li></ul></nav></div><div class="book-search hidden"><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/ required pattern=\S+.*>
<span class=clear_search><img src=/svg/close.svg onclick=clearInput()></span><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><script>function clearInput(){document.getElementById("book-search-input").value="";for(var e=document.getElementById("book-search-results");e.firstChild;)e.removeChild(e.firstChild)}</script><ul class=book-languages><li><a class="flex align-center"><img src=/svg/language.svg class=book-icon alt=Languages>
简体中文</a></label><ul><li><a href=https://wangy325.github.io/en/>English</a></li></ul></li></ul></div><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>一次服务器OOM故障</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><div id=toc-new><ul class=nav><li class=nav-item><a id=t1Linux系统日志 href=javascript:void(0) onclick='return scrolly("1-linux系统日志"),!1'>1 Linux系统日志</a></li><li class=nav-item><a id=t2设置服务器时区tzselect href=javascript:void(0) onclick='return scrolly("2-设置服务器时区-tzselect"),!1'>2 设置服务器时区 tzselect</a></li><li class=nav-item><a id=t3查看并设置系统自启动服务 href=javascript:void(0) onclick='return scrolly("3-查看并设置系统自启动服务"),!1'>3 查看并设置系统自启动服务</a></li><li class=nav-item><a id=t4top命令是一个交互命令 href=javascript:void(0) onclick='return scrolly("4-top命令是一个交互命令"),!1'>4 top命令是一个交互命令</a></li></ul></div><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></aside></header><article class="markdown book-post"><h1>一次服务器OOM故障</h1><div class="postmeta flex align-cneter" style=justify-content:center><div class="created flex align-cneter"><img src=/svg/calendar-event.svg class=book-icon alt>
<a title='创建者 wangy325'>2021-02-20</a></div><div class="tags flex align-center"><img src=/svg/tag-alt.svg class=book-icon alt>
<a href=/zh-cn/tags/server/>Server</a></div></div><p>使用<code>idm</code>下载y2b视频导致服务器内存溢出，内核强制关闭了服务进程。</p><p>通过系统日志定位原因，并介绍了服务器维护的几个相关命令。</p><h2 id=1-linux系统日志>1 Linux系统日志
<a class=anchor href=#1-linux%e7%b3%bb%e7%bb%9f%e6%97%a5%e5%bf%97>#</a></h2><p>系统服务日志地址： <code>/var/log/messages</code></p><pre tabindex=0><code>Feb 19 16:02:12 vultr kernel: oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/,task=firewalld,pid=1626,uid=0
Feb 19 16:02:12 vultr kernel: Out of memory: Killed process 1626 (firewalld) total-vm:358420kB, anon-rss:22096kB, file-rss:4kB, shmem-rss:0kB
Feb 19 16:02:12 vultr kernel: oom_reaper: reaped process 1626 (firewalld), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB
Feb 19 16:02:12 vultr systemd: firewalld.service: main process exited, code=killed, status=9/KILL
Feb 19 16:02:12 vultr systemd: Unit firewalld.service entered failed state.
Feb 19 16:02:12 vultr systemd: firewalld.service failed.
</code></pre><p>日志说明的很清楚了，<strong>内存溢出</strong>，系统杀掉了部分进程。</p><blockquote><p>至于是否网络请求占用了太多的系统资源，还需要进一步认证</p></blockquote><h2 id=2-设置服务器时区-tzselect>2 设置服务器时区 tzselect
<a class=anchor href=#2-%e8%ae%be%e7%bd%ae%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%97%b6%e5%8c%ba-tzselect>#</a></h2><p>由于并非使用国内的服务器，也一直懒于管理，导致服务器的时区并非GMT+8，日志看起来非常的别扭，因此，将服务器时区顺道进行一番设置。</p><blockquote><p>设置时区的多种方法其中一种
参考：https://www.cnblogs.com/dead-trap-ramble/p/3462448.html</p></blockquote><p>服务器时区为+0，需要将其改为+8，这样系统日志的时间能够对应上。</p><p>使用<code>date -R</code>命令查看当前系统时间/时区信息</p><p>使用<code>tzselect</code>命令选择时区，中国大陆根据命令提示选择<code>Asia/China/Beijing</code>即可。</p><p>命令执行完毕之后，还会提醒你将<code>TZ='Asia/Shanghai'; export TZ</code>写入到profile中，一般为根目录下的<code>.bash_profile</code>文件：</p><pre tabindex=0><code>echo &#34;TZ=&#39;Asia/Shanghai&#39;; export TZ&#34; &gt;&gt; .bash_profile
</code></pre><p>随即使用</p><pre tabindex=0><code>source  .bash_profile
</code></pre><p>命令刷新配置文件，再使用<code>date -R</code>命令查看日期，已经和中国大陆时间同步。</p><p>另外，为了防止服务器重启之后，配置失效[^没有实测]，可以覆盖系统的配置文件：</p><pre tabindex=0><code>cp /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime
</code></pre><p>这条命令会有一条警告信息，覆盖即可。</p><h2 id=3-查看并设置系统自启动服务>3 查看并设置系统自启动服务
<a class=anchor href=#3-%e6%9f%a5%e7%9c%8b%e5%b9%b6%e8%ae%be%e7%bd%ae%e7%b3%bb%e7%bb%9f%e8%87%aa%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1>#</a></h2><p>使用命令<code>systemctl list-unit-files | grep enabled</code>可以查看当前系统开机启动的服务信息。</p><p>实际上，再centOS中，使用<code>chkconfig --list</code>命令也可以获取使用<code>systemctl...</code>命令的提示：</p><pre tabindex=0><code># chkconfg --list
Note: This output shows SysV services only and does not include native
      systemd services. SysV configuration data might be overridden by native
      systemd configuration.

      If you want to list systemd services use &#39;systemctl list-unit-files&#39;.
      To see services enabled on particular target use
      &#39;systemctl list-dependencies [target]&#39;.

denyhosts       0:off   1:off   2:on    3:on    4:on    5:on    6:off
netconsole      0:off   1:off   2:off   3:off   4:off   5:off   6:off
network         0:off   1:off   2:on    3:on    4:on    5:on    6:off
</code></pre><p>可以简单的通过<code>systemctl enable nginx</code>将nginx服务加入到自启动服务列表里面去。</p><p>linux确实是通过配置文件控制服务的启动，此处尚且不展开这部分内容，更详细的内容可以参考：</p><ol><li><a href=https://www.cnblogs.com/nerxious/archive/2013/01/18/2866548.HTML>Linux中设置服务自启动的三种方式</a></li><li><a href=https://www.cnblogs.com/top5/archive/2009/09/18/1569093.html>linux开机启动服务的修改与查看</a></li></ol><h2 id=4-top命令是一个交互命令>4 top命令是一个交互命令
<a class=anchor href=#4-top%e5%91%bd%e4%bb%a4%e6%98%af%e4%b8%80%e4%b8%aa%e4%ba%a4%e4%ba%92%e5%91%bd%e4%bb%a4>#</a></h2><p>控制台输入<code>top</code>可以查看当前系统的一些信息，并且这些信息是动态刷新的。</p><p><code>top</code>命令是一个可交互的命令，可以通过快捷键指令进行交互，有一些常见的快捷指令：</p><ul><li>M：按照内存占用排序进程</li><li>m：切换内存占用的显示方式</li><li>P：按照cpu占用排序进程</li></ul><p>更多的快捷指令可以参考：https://man.linuxde.net/top</p><p>除了<code>top</code>之外，还有一个<code>ps</code>命令：http://c.biancheng.net/view/1062.html，
记住<code>ps aux | grep xxx</code>就行了^_^。</p></article><div class=next-prev><hr><div class="page-navi flex" id=pagenavi><div class=pre-page>←
<a href=https://wangy325.github.io/zh-cn/posts/2021/20210324_%E4%BD%BF%E7%94%A8mysql%E7%9A%84%E8%A1%8C%E9%94%81/>MySQL显式锁简单介绍</a></div><div class=next-page><a href=https://wangy325.github.io/zh-cn/posts/2021/20210220_use-springboot-messagesource/>在SpringBoot中使用MessageSource</a> →</div></div></div><section class=related><hr></section><div class=book-comments><div class=giscus-thread></div><script src=https://giscus.app/client.js data-repo=wangy325/wangy325.github.io data-repo-id=R_kgDOHhhDZg data-category=Announcements data-category-id=DIC_kwDOHhhDZs4ChbMn data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=noborder_light data-loading=lazy data-lang=zh-CN crossorigin=anonymous async></script></div><div class=copyright><hr class=cline><p>Notes and Memos by wangy325
<a href=https://creativecommons.org/licenses/by/4.0/deed.en title="Creative Commons Attribution">&copy; CC BY 4.0</a></p><p>2019-2025. Powered by
<a href=https://github.com/alex-shpak/hugo-book>Hugo Book</a>
Presented by Github.</p></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><div id=toc-new><ul class=nav><li class=nav-item><a id=t1Linux系统日志 href=javascript:void(0) onclick='return scrolly("1-linux系统日志"),!1'>1 Linux系统日志</a></li><li class=nav-item><a id=t2设置服务器时区tzselect href=javascript:void(0) onclick='return scrolly("2-设置服务器时区-tzselect"),!1'>2 设置服务器时区 tzselect</a></li><li class=nav-item><a id=t3查看并设置系统自启动服务 href=javascript:void(0) onclick='return scrolly("3-查看并设置系统自启动服务"),!1'>3 查看并设置系统自启动服务</a></li><li class=nav-item><a id=t4top命令是一个交互命令 href=javascript:void(0) onclick='return scrolly("4-top命令是一个交互命令"),!1'>4 top命令是一个交互命令</a></li></ul></div><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></div></aside></main><div class=back-to-top><div id=back-to-top><img src=/svg/chevrons-up.svg srcset="/svg/chevrons-up.svg 500w" onclick=topFunction() class=black>
<img title=回到顶部 src=/svg/chevrons-up-blue.svg srcset="/svg/chevrons-up-blue.svg 500w" onclick=topFunction() class=blue></div><script>let mybutton=document.getElementById("back-to-top");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>500||document.documentElement.scrollTop>500?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){window.scrollTo({top:0,behavior:"smooth"})}</script></div><script src=/js/scroll-listening.js></script></body></html>
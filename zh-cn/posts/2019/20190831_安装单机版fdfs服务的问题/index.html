<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文记录了安装fdfs单机文件服务时，遇到的问题，主要是nginx的配置上。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://wangy325.github.io/zh-cn/posts/2019/20190831_%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88fdfs%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98/"><meta property="og:site_name" content="xf&pl"><meta property="og:title" content="单机版fdfs服务遇到的问题"><meta property="og:description" content="本文记录了安装fdfs单机文件服务时，遇到的问题，主要是nginx的配置上。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-31T00:00:00+08:00"><meta property="article:modified_time" content="2019-08-31T00:00:00+08:00"><meta property="article:tag" content="Server"><title>单机版fdfs服务遇到的问题 | xf&amp;pl</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://wangy325.github.io/zh-cn/posts/2019/20190831_%E5%AE%89%E8%A3%85%E5%8D%95%E6%9C%BA%E7%89%88fdfs%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98/><link rel=stylesheet href=/book.min.44fb820232d7755948c85a8db5067ca0486c5a61f206e58f31c4255dccbc7c17.css integrity="sha256-RPuCAjLXdVlIyFqNtQZ8oEhsWmHyBuWPMcQlXcy8fBc=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/zh-cn.search.min.1552d27fabd3c4e5e4ae761bfe86c4e7b3f89b1c98b601ecf686d4d31ac14217.js integrity="sha256-FVLSf6vTxOXkrnYb/obE57P4mxyYtgHs9obU0xrBQhc=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-HHNKR5H8KN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HHNKR5H8KN")}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><div class=navi-bar id=navibar><div id=page-title><h2 class=book-brand><a class="flex align-center" href=/zh-cn/><span>xf&amp;pl</span></a></h2></div><div class=page-navi-col><nav><ul><li><a href=/zh-cn/docs/java/>Java</a></li><li><a href=/zh-cn/docs/design_pattern/>DP</a></li><li class=book-section-flat><a href=/zh-cn/docs/note/>Mooc</a></li><li class=book-section-flat><a href=/zh-cn/docs/snippets/>Snippets</a></li></ul><ul><li><a href=/zh-cn/posts/>Blog</a></li><li><a href=/zh-cn/archive/>Archive</a></li></ul></nav></div><div class="book-search hidden"><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/ required pattern=\S+.*>
<span class=clear_search><img src=/svg/close.svg onclick=clearInput()></span><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><script>function clearInput(){document.getElementById("book-search-input").value="";for(var e=document.getElementById("book-search-results");e.firstChild;)e.removeChild(e.firstChild)}</script><ul class=book-languages><li><a class="flex align-center"><img src=/svg/language.svg class=book-icon alt=Languages>
简体中文</a></label><ul><li><a href=https://wangy325.github.io/en/>English</a></li></ul></li></ul></div><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>单机版fdfs服务遇到的问题</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></aside></header><article class="markdown book-post"><h1>单机版fdfs服务遇到的问题</h1><div class="postmeta flex align-cneter" style=justify-content:center><div class="created flex align-cneter"><img src=/svg/calendar-event.svg class=book-icon alt>
<a title='创建者 wangy325'>2019-08-31</a></div><div class="tags flex align-center"><img src=/svg/tag-alt.svg class=book-icon alt>
<a href=/zh-cn/tags/server/>Server</a></div></div><blockquote class="book-hint danger"><a class=hint-start>“</a><p>此文章记录的内容已经过时，现在有更好的文件存储方案，如
<a href=https://min.io/docs/minio/linux/index.html>minIO</a>。</p></blockquote><hr><p>简单记录了2个在安装单机版fdfs服务遇到的问题，虽然报错信息不同，但是问题出在同一个地方：</p><blockquote><p>nginx版本与ngx_http_fastdfs_module版本
nginx版本1.16.1
module版本1.20</p></blockquote><p>这个版本的混用会导致编译和配置时分别遇到致命错误</p><ol><li><p>nginx1.12编译出现
<a href=https://github.com/happyfish100/fastdfs-nginx-module/issues/31>/usr/include/fastdfs/fdfs_define.h:15:27: fatal error: common_define.h: No such file or directory</a></p></li><li><p>按照1法解决编译问题之后，紧接着会出现配置文件错误 <code>unknown directive "ngx_http_fastdfs_module"</code>，个人推测虽然在解决第一个问题（通过修改fdfs_module的配置文件使得编译通过）时，nginx的模块实际上没有安装成功</p></li><li><p>模块安装成功的标志是</p><pre tabindex=0><code> [root@shell ~]# nginx -V
 nginx version: nginx/1.12.1
 built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC)
 configure arguments: --add-module=/opt/fdfs/fastdfs-nginx-module-revise/src
</code></pre></li></ol><p>最后使用nginx-1.12.0以及</p><pre tabindex=0><code># 这里为啥这么长一串呢，因为最新版的master与当前nginx有些版本问题
# wget https://github.com/happyfish100/fastdfs-nginx-module/archive/5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip

# 解压
# unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip

# 重命名
# mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master
</code></pre><p>解决问题：</p><p><del>centOS上安装nginx有2种方式</del><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><ul><li>通过包管理器（yum命令）安装（未测试）</li><li>通过源码安装</li></ul><p>这里说一下通过源码安装的几个点：</p><ul><li><p>网络上的其他教程说的比较细致了，几个依赖一定要先安装</p><pre tabindex=0><code>yum install gcc-c++
yum install -y pcre pcre-devel
yum install -y zlib zlib-devel
yum install -y openssl openssl-devel
</code></pre></li><li><p>如果<code>./configure</code>命令后面不接
<a href=https://blog.csdn.net/Eric1012/article/details/6052154>任何参数</a>的话，nginx默认安装在<code>/usr/local/nginx</code>下，以及nginx启动需要的作用资源均在此目录下</p><pre tabindex=0><code>[root@shell nginx-1.12.1]# ./configure --help
  --help                             print this message

  --prefix=PATH                      set installation prefix
  --sbin-path=PATH                   set nginx binary pathname
  --modules-path=PATH                set modules path
  --conf-path=PATH                   set nginx.conf pathname
  --error-log-path=PATH              set error log pathname
  --pid-path=PATH                    set nginx.pid pathname
  --lock-path=PATH                   set nginx.lock pathname
  ...省略内容 ...
</code></pre><p>如上可以自定义编译nginx的参数，这也是能为nginx添加<code>ngx_http_fastdfs_modul</code>模块的原因。</p><p>题外：如果安装过程完全参照
<a href=https://www.cnblogs.com/chiangchou/p/fastdfs.html#_label2_0>这篇文章</a>的话，或许就不会有这个问题了</p></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>使用
<a href=#https://nginx.org/en/linux_packages.html#RHEL-CentOS>nginx官网推荐</a>的方式安装最方便&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><div class=next-prev><hr><div class="page-navi flex" id=pagenavi><div class=pre-page>←
<a href=https://wangy325.github.io/zh-cn/posts/2020/20200314_SpringBoot-aop-demo/>SpringBoot使用AOP的简单示例</a></div><div class=next-page><a href=https://wangy325.github.io/zh-cn/posts/2019/20190828_%E5%85%B3%E4%BA%8Eforever%E5%90%AF%E5%8A%A8node%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%97%AE%E9%A2%98/>关于forever启动node服务的问题</a> →</div></div></div><section class=related><hr></section><div class=book-comments><div class=giscus-thread></div><script src=https://giscus.app/client.js data-repo=wangy325/wangy325.github.io data-repo-id=R_kgDOHhhDZg data-category=Announcements data-category-id=DIC_kwDOHhhDZs4ChbMn data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=noborder_light data-loading=lazy data-lang=zh-CN crossorigin=anonymous async></script></div><div class=copyright><hr class=cline><p>Notes and Memos by wangy325
<a href=https://creativecommons.org/licenses/by/4.0/deed.en title="Creative Commons Attribution">&copy; CC BY 4.0</a></p><p>2019-2025. Powered by
<a href=https://github.com/alex-shpak/hugo-book>Hugo Book</a>
Presented by Github.</p></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></div></aside></main><div class=back-to-top><div id=back-to-top><img src=/svg/chevrons-up.svg srcset="/svg/chevrons-up.svg 500w" onclick=topFunction() class=black>
<img title=回到顶部 src=/svg/chevrons-up-blue.svg srcset="/svg/chevrons-up-blue.svg 500w" onclick=topFunction() class=blue></div><script>let mybutton=document.getElementById("back-to-top");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>500||document.documentElement.scrollTop>500?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){window.scrollTo({top:0,behavior:"smooth"})}</script></div><script src=/js/scroll-listening.js></script></body></html>
<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Redis 
  v2.8 之后提供了高可用实现Redis Sentinel，实现了主从复制以及被动主备切换。
  v3.0 之后提供了分布式实现Redis Cluster。
本文讨论的是使用Sentinel搭建Redis高可用服务。

If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel High-Availability environment1.
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://wangy325.github.io/zh-cn/docs/craft/db/redis/build-redis-sentinel/"><meta property="og:site_name" content="Endless River"><meta property="og:title" content="Redis Sentinel高可用实现"><meta property="og:description" content="Redis v2.8 之后提供了高可用实现Redis Sentinel，实现了主从复制以及被动主备切换。 v3.0 之后提供了分布式实现Redis Cluster。
本文讨论的是使用Sentinel搭建Redis高可用服务。
If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel High-Availability environment1."><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2019-08-14T16:01:23+08:00"><meta property="article:modified_time" content="2024-08-07T11:22:41+08:00"><title>Redis Sentinel高可用实现 | Endless River</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=https://wangy325.github.io/zh-cn/docs/craft/db/redis/build-redis-sentinel/><link rel=stylesheet href=/book.min.cb8cc0b66e5791e572c7ff9d0d629871c84cd3f1033f47dd9a94a61abb732b85.css integrity="sha256-y4zAtm5XkeVyx/+dDWKYcchM0/EDP0fdmpSmGrtzK4U=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/zh-cn.search.min.b86fa60ac996061b6c64d0ff9d4b4f922a0d1d7d24f1958910126143c9ac1ebb.js integrity="sha256-uG+mCsmWBhtsZND/nUtPkioNHX0k8ZWJEBJhQ8msHrs=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-HHNKR5H8KN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HHNKR5H8KN")}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><div class=navi-bar id=navibar><div id=page-title><h2 class=book-brand><a class="flex align-center" href=/zh-cn/><span>Endless River</span></a></h2></div><div class=page-navi-col><nav><ul><li class=book-section-flat><a href=/zh-cn/docs/java/>Java</a><ul><li><a role=button>面向对象</a><ul><li><a href=/zh-cn/docs/java/basic/1_%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6/>访问权限修饰符</a></li><li><a href=/zh-cn/docs/java/basic/2_static%E5%85%B3%E9%94%AE%E5%AD%97/>static关键字</a></li><li><a href=/zh-cn/docs/java/basic/3_%E4%BC%A0%E5%80%BC%E8%BF%98%E6%98%AF%E4%BC%A0%E5%BC%95%E7%94%A8/>传值还是传引用</a></li><li><a href=/zh-cn/docs/java/basic/4_final%E5%85%B3%E9%94%AE%E5%AD%97/>final关键字</a></li><li><a href=/zh-cn/docs/java/basic/5_Object%E8%B6%85%E7%B1%BB/>Object超类</a></li><li><a href=/zh-cn/docs/java/basic/5_%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A%E4%B8%8E%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9A/>动态绑定与静态绑定</a></li><li><a href=/zh-cn/docs/java/basic/6_%E6%8A%BD%E8%B1%A1%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3/>抽象类与接口</a></li><li><a href=/zh-cn/docs/java/basic/7_lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/>Lambda与函数式接口</a></li><li><a href=/zh-cn/docs/java/basic/8_%E5%86%85%E9%83%A8%E7%B1%BB/>内部类</a></li><li><a href=/zh-cn/docs/java/basic/11_java-new-time-api/>Java8日期和时间API</a></li></ul></li><li><a href=/zh-cn/docs/java/collections/>集合框架</a><ul><li><a href=/zh-cn/docs/java/collections/1_List_arraylist/>ArrayList</a></li><li><a href=/zh-cn/docs/java/collections/1_List_linkedlist/>LinkedList</a></li><li><a href=/zh-cn/docs/java/collections/2_Queue/>Queue</a></li><li><a href=/zh-cn/docs/java/collections/3_Set/>Set</a></li><li><a href=/zh-cn/docs/java/collections/4_Map_hash_tree_map/>HashMap和TreeMap</a></li><li><a href=/zh-cn/docs/java/collections/4_Map_linkedhashmap/>LinkedHashMap</a></li><li><a href=/zh-cn/docs/java/collections/5_HashMap%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/>HashMap的源码分析</a></li><li><a href=/zh-cn/docs/java/collections/6_Collections/>Collections工具类</a></li></ul></li><li><a href=/zh-cn/docs/java/concurrency/>并发</a><ul><li><a role=button>锁与同步</a><ul><li><a href=/zh-cn/docs/java/concurrency/conecptes/1%E7%BA%BF%E7%A8%8B%E4%B8%8E%E4%BB%BB%E5%8A%A1_1/>线程与任务(一)</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/1%E7%BA%BF%E7%A8%8B%E4%B8%8E%E4%BB%BB%E5%8A%A1_2/>线程与任务(二)</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_1/>资源访问受限--引论</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_2_%E9%94%81%E5%92%8C%E6%9D%A1%E4%BB%B6/>资源访问受限-锁和条件</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_3_synchronized/>synchronized关键字</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_4_%E5%8E%9F%E5%AD%90%E6%80%A7%E4%B8%8E%E5%8E%9F%E5%AD%90%E7%B1%BB/>原子性和可见性</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_5_%E7%BA%BF%E7%A8%8B%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8/>线程本地存储</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/3%E8%8E%B7%E5%8F%96%E4%BB%BB%E5%8A%A1%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC/>获取任务的返回值</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/4%E6%AD%BB%E9%94%81/>死锁问题2例</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/5%E7%BB%88%E7%BB%93%E4%BB%BB%E5%8A%A1/>终结任务</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/6%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%8E%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/>生产者-消费者与阻塞队列</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/6%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E4%BD%BF%E7%94%A82%E4%BE%8B/>阻塞队列的使用2例</a></li></ul></li><li><a role=button>线程池</a><ul><li><a href=/zh-cn/docs/java/concurrency/pools/7_1_Executors_and_ExecutorService/>Executors与Executor框架</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/7_2_ThreadPoolExecutor1/>ThreadPoolExecutor(一)</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/7_3_ThreadPoolExecutor2/>ThreadPoolExecutor(二)</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/7_4_CompletionService/>CompletionService</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/8_1_ScheduledExecutorService1/>ScheduledExecutorService(一)</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/8_2_ScheduledExecutorService2/>ScheduledExecutorService(二)</a></li></ul></li><li><a role=button>并发组件</a><ul><li><a href=/zh-cn/docs/java/concurrency/components/9_1_countdownlatch/>CountDownLatch</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_2_cyclicbarrier/>CyclicBarrier</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_3_semaphore/>Semaphore</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_4_exchanger/>Exchanger</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_5_priorityblockqueue_delayqueue/>PriorityBlockingQueue and DelayQueue</a></li></ul></li></ul></li><li><a role=button>JVM</a><ul><li><a href=/zh-cn/docs/java/jvm/Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E8%AF%A6%E8%A7%A3/>Java内存区域详解(转)</a></li><li><a href=/zh-cn/docs/java/jvm/java-gc/>JVM垃圾回收概要(转)</a></li><li><a href=/zh-cn/docs/java/jvm/10_Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%8Evolatile%E5%85%B3%E9%94%AE%E5%AD%97/>JMM与volatile关键字(转)</a></li></ul></li><li><a role=button>Spring</a><ul><li><a href=/zh-cn/docs/java/spring/SpringBoot-aop-demo/>SpringBoot使用AOP的简单示例</a></li><li><a href=/zh-cn/docs/java/spring/%E5%9C%A8SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8MockMvc%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/>在SpringBoot项目中使用MockMvc进行接口测试</a></li><li><a href=/zh-cn/docs/java/spring/spring-transaction-propagation/>Spring声明式事务的使用</a></li></ul></li></ul></li><li class=book-section-flat><span>Craft</span><ul><li><a role=button>存储数据</a><ul><li><a role=button>MySQL</a><ul><li><a href=/zh-cn/docs/craft/db/sql/1_%E5%9C%A8centOS%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEmysql%E6%95%B0%E6%8D%AE%E5%BA%93/>CentOS安装并配置MySQL</a></li><li><a href=/zh-cn/docs/craft/db/sql/2_MySQL%E7%9A%84%E5%87%A0%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/>MySQL字符串处理函数</a></li><li><a href=/zh-cn/docs/craft/db/sql/4_MySQL%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/>事务隔离级别与MVCC</a></li><li><a href=/zh-cn/docs/craft/db/sql/5_%E4%BD%BF%E7%94%A8mysql%E7%9A%84%E8%A1%8C%E9%94%81/>MySQL显式锁简单介绍</a></li><li><a href=/zh-cn/docs/craft/db/sql/6_mysql%E6%AD%BB%E9%94%81/>MySQL死锁</a></li></ul></li><li><a role=button>Redis</a><ul><li><a href=/zh-cn/docs/craft/db/redis/redis-all/>redis必知必会(转)</a></li><li><a href=/zh-cn/docs/craft/db/redis/build-redis-sentinel/ class=active>Redis Sentinel高可用实现</a></li><li><a href=/zh-cn/docs/craft/db/redis/deploy-redis-cluster-with-docker/>使用docker镜像快速搭建redis集群开发环境</a></li><li><a href=/zh-cn/docs/craft/db/redis/bloom-filter/>布隆过滤器(转)</a></li></ul></li></ul></li><li><a href=/zh-cn/docs/craft/algo/>Algorithms</a><ul><li><a href=/zh-cn/docs/craft/algo/%E5%90%8C%E4%BD%99%E5%AE%9A%E7%90%86%E4%B8%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A5%E7%A0%81/>同余定理与二进制补码</a></li><li><a href=/zh-cn/docs/craft/algo/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97/>移位运算</a></li><li><a href=/zh-cn/docs/craft/algo/%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97/>异或运算</a></li><li><a href=/zh-cn/docs/craft/algo/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/>位运算的小技巧</a></li><li><a href=/zh-cn/docs/craft/algo/01%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/>背包问题2例</a></li></ul></li><li><a role=button>设计模式</a><ul><li><a role=button>Creation</a><ul><li><a href=/zh-cn/docs/craft/design_pattern/creation/1_singleton/>单例模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/creation/2_factory/>工厂模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/creation/3_abstract_factory/>抽象工厂模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/creation/4_builder/>建造者模式</a></li></ul></li><li><a role=button>Behaviour</a><ul><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/1_command/>命令模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/2_observer/>观察者模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/3_strategy/>策略模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/4_template_method/>模板方法模式</a></li></ul></li><li><a role=button>Structural</a><ul><li><a href=/zh-cn/docs/craft/design_pattern/structure/3_decorator/>装饰者模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/structure/2_adaptor/>适配器模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/structure/4_%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/>外观模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/structure/proxy/>代理模式</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><span>Note</span><ul><li><a href=/zh-cn/docs/note/course/>慕课笔记</a><ul><li><a href=/zh-cn/docs/note/course/operating_system_peking/>操作系统原理</a><ul><li><a href=/zh-cn/docs/note/course/operating_system_peking/1_intro/>引论</a></li><li><a href=/zh-cn/docs/note/course/operating_system_peking/2_env_and_logic/>操作系统运行环境与机制</a></li><li><a href=/zh-cn/docs/note/course/operating_system_peking/3_processes_and_threads/>进程和线程模型</a></li></ul></li><li><a href=/zh-cn/docs/note/course/algorithms_part1/>算法-第一部分</a><ul></ul></li></ul></li><li><a role=button>Python</a><ul><li><a role=button>Snippets</a><ul><li><a href=/zh-cn/docs/note/pys/snippets/1_flow_control/>流程控制语句</a></li><li><a href=/zh-cn/docs/note/pys/snippets/2_data_list/>列表（list）</a></li><li><a href=/zh-cn/docs/note/pys/snippets/3_data_str/>字符串，元组和字典</a></li><li><a href=/zh-cn/docs/note/pys/snippets/4_func/>函数式编程</a></li><li><a href=/zh-cn/docs/note/pys/snippets/4_important_funcs/>4个重要的内置函数</a></li><li><a href=/zh-cn/docs/note/pys/snippets/5_file_io/>格式化输出与文件I/O</a></li><li><a href=/zh-cn/docs/note/pys/snippets/6_try_excep/>异常处理</a></li><li><a href=/zh-cn/docs/note/pys/snippets/7_scope/>命名空间与作用域</a></li><li><a href=/zh-cn/docs/note/pys/snippets/8_class_type/>类与对象</a></li><li><a href=/zh-cn/docs/note/pys/snippets/9_decoration/>闭包与装饰器</a></li><li><a href=/zh-cn/docs/note/pys/snippets/10_decoration_2/>装饰器2</a></li><li><a href=/zh-cn/docs/note/pys/snippets/11_threading/>线程模型</a></li><li><a href=/zh-cn/docs/note/pys/snippets/12_threading_lock/>线程-锁</a></li><li><a href=/zh-cn/docs/note/pys/snippets/13_threading_condition/>线程-条件</a></li><li><a href=/zh-cn/docs/note/pys/snippets/14_threading_semaphore/>线程-信号量</a></li><li><a href=/zh-cn/docs/note/pys/snippets/15_threading_event/>线程-事件</a></li></ul></li></ul></li><li><a role=button>Translations</a><ul><li><a href=/zh-cn/docs/note/translations/use-springboot-messagesource/>在SpringBoot中使用MessageSource</a></li><li><a href=/zh-cn/docs/note/translations/guide-to-logback-cn/>使用Logback记录日志</a></li><li><a href=/zh-cn/docs/note/translations/how2use-printf/>使用printf格式化输出</a></li></ul></li></ul></li></ul><ul><li><a href=/zh-cn/posts/>Blog</a></li><li><a href=/zh-cn/about/>About</a></li><li><a href=/zh-cn/archive/>Archive</a></li><li><a href=/zh-cn/memos/>Memo</a></li></ul></nav></div><div class="book-search hidden"><input type=text id=book-search-input placeholder aria-label maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><a class="flex align-center"><img src=/svg/language.svg class=book-icon alt=Languages>
简体中文</a></label><ul><li><a href=https://wangy325.github.io/en/>English</a></li></ul></li></ul></div><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/zh-cn/><span>Endless River</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder aria-label maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
简体中文</a></label><ul><li><a href=https://wangy325.github.io/en/>English</a></li></ul></li></ul><ul><li class=book-section-flat><a href=/zh-cn/docs/java/>Java</a><ul><li><input type=checkbox id=section-287084f81620420b7ed7e40a42c44d2f class=toggle>
<label for=section-287084f81620420b7ed7e40a42c44d2f class="flex justify-between"><a role=button>面向对象</a></label><ul><li><a href=/zh-cn/docs/java/basic/1_%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6/>访问权限修饰符</a></li><li><a href=/zh-cn/docs/java/basic/2_static%E5%85%B3%E9%94%AE%E5%AD%97/>static关键字</a></li><li><a href=/zh-cn/docs/java/basic/3_%E4%BC%A0%E5%80%BC%E8%BF%98%E6%98%AF%E4%BC%A0%E5%BC%95%E7%94%A8/>传值还是传引用</a></li><li><a href=/zh-cn/docs/java/basic/4_final%E5%85%B3%E9%94%AE%E5%AD%97/>final关键字</a></li><li><a href=/zh-cn/docs/java/basic/5_Object%E8%B6%85%E7%B1%BB/>Object超类</a></li><li><a href=/zh-cn/docs/java/basic/5_%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A%E4%B8%8E%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9A/>动态绑定与静态绑定</a></li><li><a href=/zh-cn/docs/java/basic/6_%E6%8A%BD%E8%B1%A1%E7%B1%BB%E4%B8%8E%E6%8E%A5%E5%8F%A3/>抽象类与接口</a></li><li><a href=/zh-cn/docs/java/basic/7_lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/>Lambda与函数式接口</a></li><li><a href=/zh-cn/docs/java/basic/8_%E5%86%85%E9%83%A8%E7%B1%BB/>内部类</a></li><li><a href=/zh-cn/docs/java/basic/11_java-new-time-api/>Java8日期和时间API</a></li></ul></li><li><input type=checkbox id=section-3d2f820e49b3d97a7a712be90f9fd6ad class=toggle>
<label for=section-3d2f820e49b3d97a7a712be90f9fd6ad class="flex justify-between"><a href=/zh-cn/docs/java/collections/>集合框架</a></label><ul><li><a href=/zh-cn/docs/java/collections/1_List_arraylist/>ArrayList</a></li><li><a href=/zh-cn/docs/java/collections/1_List_linkedlist/>LinkedList</a></li><li><a href=/zh-cn/docs/java/collections/2_Queue/>Queue</a></li><li><a href=/zh-cn/docs/java/collections/3_Set/>Set</a></li><li><a href=/zh-cn/docs/java/collections/4_Map_hash_tree_map/>HashMap和TreeMap</a></li><li><a href=/zh-cn/docs/java/collections/4_Map_linkedhashmap/>LinkedHashMap</a></li><li><a href=/zh-cn/docs/java/collections/5_HashMap%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/>HashMap的源码分析</a></li><li><a href=/zh-cn/docs/java/collections/6_Collections/>Collections工具类</a></li></ul></li><li><input type=checkbox id=section-6d6d0626deeb0ce0f9826f9dabe58c16 class=toggle>
<label for=section-6d6d0626deeb0ce0f9826f9dabe58c16 class="flex justify-between"><a href=/zh-cn/docs/java/concurrency/>并发</a></label><ul><li><input type=checkbox id=section-69ab6f6f868fbdf1ba043c30f82736d8 class=toggle>
<label for=section-69ab6f6f868fbdf1ba043c30f82736d8 class="flex justify-between"><a role=button>锁与同步</a></label><ul><li><a href=/zh-cn/docs/java/concurrency/conecptes/1%E7%BA%BF%E7%A8%8B%E4%B8%8E%E4%BB%BB%E5%8A%A1_1/>线程与任务(一)</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/1%E7%BA%BF%E7%A8%8B%E4%B8%8E%E4%BB%BB%E5%8A%A1_2/>线程与任务(二)</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_1/>资源访问受限--引论</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_2_%E9%94%81%E5%92%8C%E6%9D%A1%E4%BB%B6/>资源访问受限-锁和条件</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_3_synchronized/>synchronized关键字</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_4_%E5%8E%9F%E5%AD%90%E6%80%A7%E4%B8%8E%E5%8E%9F%E5%AD%90%E7%B1%BB/>原子性和可见性</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/2%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE%E5%8F%97%E9%99%90_5_%E7%BA%BF%E7%A8%8B%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8/>线程本地存储</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/3%E8%8E%B7%E5%8F%96%E4%BB%BB%E5%8A%A1%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC/>获取任务的返回值</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/4%E6%AD%BB%E9%94%81/>死锁问题2例</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/5%E7%BB%88%E7%BB%93%E4%BB%BB%E5%8A%A1/>终结任务</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/6%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%8E%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/>生产者-消费者与阻塞队列</a></li><li><a href=/zh-cn/docs/java/concurrency/conecptes/6%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E4%BD%BF%E7%94%A82%E4%BE%8B/>阻塞队列的使用2例</a></li></ul></li><li><input type=checkbox id=section-138a6f4325e97cca77bc6f9a915a5526 class=toggle>
<label for=section-138a6f4325e97cca77bc6f9a915a5526 class="flex justify-between"><a role=button>线程池</a></label><ul><li><a href=/zh-cn/docs/java/concurrency/pools/7_1_Executors_and_ExecutorService/>Executors与Executor框架</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/7_2_ThreadPoolExecutor1/>ThreadPoolExecutor(一)</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/7_3_ThreadPoolExecutor2/>ThreadPoolExecutor(二)</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/7_4_CompletionService/>CompletionService</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/8_1_ScheduledExecutorService1/>ScheduledExecutorService(一)</a></li><li><a href=/zh-cn/docs/java/concurrency/pools/8_2_ScheduledExecutorService2/>ScheduledExecutorService(二)</a></li></ul></li><li><input type=checkbox id=section-c134c28643238ad138745528076adeb9 class=toggle>
<label for=section-c134c28643238ad138745528076adeb9 class="flex justify-between"><a role=button>并发组件</a></label><ul><li><a href=/zh-cn/docs/java/concurrency/components/9_1_countdownlatch/>CountDownLatch</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_2_cyclicbarrier/>CyclicBarrier</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_3_semaphore/>Semaphore</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_4_exchanger/>Exchanger</a></li><li><a href=/zh-cn/docs/java/concurrency/components/9_5_priorityblockqueue_delayqueue/>PriorityBlockingQueue and DelayQueue</a></li></ul></li></ul></li><li><input type=checkbox id=section-1fe137527ef46393c946fbc7cb576209 class=toggle>
<label for=section-1fe137527ef46393c946fbc7cb576209 class="flex justify-between"><a role=button>JVM</a></label><ul><li><a href=/zh-cn/docs/java/jvm/Java%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E8%AF%A6%E8%A7%A3/>Java内存区域详解(转)</a></li><li><a href=/zh-cn/docs/java/jvm/java-gc/>JVM垃圾回收概要(转)</a></li><li><a href=/zh-cn/docs/java/jvm/10_Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%8Evolatile%E5%85%B3%E9%94%AE%E5%AD%97/>JMM与volatile关键字(转)</a></li></ul></li><li><input type=checkbox id=section-162997d8460d3e3e2ce056aadf759dc7 class=toggle>
<label for=section-162997d8460d3e3e2ce056aadf759dc7 class="flex justify-between"><a role=button>Spring</a></label><ul><li><a href=/zh-cn/docs/java/spring/SpringBoot-aop-demo/>SpringBoot使用AOP的简单示例</a></li><li><a href=/zh-cn/docs/java/spring/%E5%9C%A8SpringBoot%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8MockMvc%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/>在SpringBoot项目中使用MockMvc进行接口测试</a></li><li><a href=/zh-cn/docs/java/spring/spring-transaction-propagation/>Spring声明式事务的使用</a></li></ul></li></ul></li><li class=book-section-flat><span>Craft</span><ul><li><input type=checkbox id=section-634f81f2121a26b2cd3998d002677fd7 class=toggle checked>
<label for=section-634f81f2121a26b2cd3998d002677fd7 class="flex justify-between"><a role=button>存储数据</a></label><ul><li><input type=checkbox id=section-a97291ad29c3a3b4bd7c61ffd8d5c44c class=toggle>
<label for=section-a97291ad29c3a3b4bd7c61ffd8d5c44c class="flex justify-between"><a role=button>MySQL</a></label><ul><li><a href=/zh-cn/docs/craft/db/sql/1_%E5%9C%A8centOS%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEmysql%E6%95%B0%E6%8D%AE%E5%BA%93/>CentOS安装并配置MySQL</a></li><li><a href=/zh-cn/docs/craft/db/sql/2_MySQL%E7%9A%84%E5%87%A0%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/>MySQL字符串处理函数</a></li><li><a href=/zh-cn/docs/craft/db/sql/4_MySQL%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/>事务隔离级别与MVCC</a></li><li><a href=/zh-cn/docs/craft/db/sql/5_%E4%BD%BF%E7%94%A8mysql%E7%9A%84%E8%A1%8C%E9%94%81/>MySQL显式锁简单介绍</a></li><li><a href=/zh-cn/docs/craft/db/sql/6_mysql%E6%AD%BB%E9%94%81/>MySQL死锁</a></li></ul></li><li><input type=checkbox id=section-bc4b2446005fdca660bd4c972e249165 class=toggle checked>
<label for=section-bc4b2446005fdca660bd4c972e249165 class="flex justify-between"><a role=button>Redis</a></label><ul><li><a href=/zh-cn/docs/craft/db/redis/redis-all/>redis必知必会(转)</a></li><li><a href=/zh-cn/docs/craft/db/redis/build-redis-sentinel/ class=active>Redis Sentinel高可用实现</a></li><li><a href=/zh-cn/docs/craft/db/redis/deploy-redis-cluster-with-docker/>使用docker镜像快速搭建redis集群开发环境</a></li><li><a href=/zh-cn/docs/craft/db/redis/bloom-filter/>布隆过滤器(转)</a></li></ul></li></ul></li><li><input type=checkbox id=section-6f60371e3df5bd386999aceaa1852abe class=toggle>
<label for=section-6f60371e3df5bd386999aceaa1852abe class="flex justify-between"><a href=/zh-cn/docs/craft/algo/>Algorithms</a></label><ul><li><a href=/zh-cn/docs/craft/algo/%E5%90%8C%E4%BD%99%E5%AE%9A%E7%90%86%E4%B8%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E8%A1%A5%E7%A0%81/>同余定理与二进制补码</a></li><li><a href=/zh-cn/docs/craft/algo/%E7%A7%BB%E4%BD%8D%E8%BF%90%E7%AE%97/>移位运算</a></li><li><a href=/zh-cn/docs/craft/algo/%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97/>异或运算</a></li><li><a href=/zh-cn/docs/craft/algo/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/>位运算的小技巧</a></li><li><a href=/zh-cn/docs/craft/algo/01%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/>背包问题2例</a></li></ul></li><li><input type=checkbox id=section-30cbf81626e3b7f7e6edb89d12c78023 class=toggle>
<label for=section-30cbf81626e3b7f7e6edb89d12c78023 class="flex justify-between"><a role=button>设计模式</a></label><ul><li><input type=checkbox id=section-42f50c16d27783d3bedd607a7e837d36 class=toggle>
<label for=section-42f50c16d27783d3bedd607a7e837d36 class="flex justify-between"><a role=button>Creation</a></label><ul><li><a href=/zh-cn/docs/craft/design_pattern/creation/1_singleton/>单例模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/creation/2_factory/>工厂模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/creation/3_abstract_factory/>抽象工厂模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/creation/4_builder/>建造者模式</a></li></ul></li><li><input type=checkbox id=section-cb39206110b74ebd45f80b2f90510acc class=toggle>
<label for=section-cb39206110b74ebd45f80b2f90510acc class="flex justify-between"><a role=button>Behaviour</a></label><ul><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/1_command/>命令模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/2_observer/>观察者模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/3_strategy/>策略模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/behaviour/4_template_method/>模板方法模式</a></li></ul></li><li><input type=checkbox id=section-7db5831683340fa833c951dc3e200088 class=toggle>
<label for=section-7db5831683340fa833c951dc3e200088 class="flex justify-between"><a role=button>Structural</a></label><ul><li><a href=/zh-cn/docs/craft/design_pattern/structure/3_decorator/>装饰者模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/structure/2_adaptor/>适配器模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/structure/4_%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/>外观模式</a></li><li><a href=/zh-cn/docs/craft/design_pattern/structure/proxy/>代理模式</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><span>Note</span><ul><li><input type=checkbox id=section-e1b333d5984dfdf0a240ff1b0a6c2115 class=toggle>
<label for=section-e1b333d5984dfdf0a240ff1b0a6c2115 class="flex justify-between"><a href=/zh-cn/docs/note/course/>慕课笔记</a></label><ul><li><input type=checkbox id=section-f0595ab9881a31f8c4cb8d57ad211189 class=toggle>
<label for=section-f0595ab9881a31f8c4cb8d57ad211189 class="flex justify-between"><a href=/zh-cn/docs/note/course/operating_system_peking/>操作系统原理</a></label><ul><li><a href=/zh-cn/docs/note/course/operating_system_peking/1_intro/>引论</a></li><li><a href=/zh-cn/docs/note/course/operating_system_peking/2_env_and_logic/>操作系统运行环境与机制</a></li><li><a href=/zh-cn/docs/note/course/operating_system_peking/3_processes_and_threads/>进程和线程模型</a></li></ul></li><li><input type=checkbox id=section-aaef4b28e93ddde0053a8bd35b72d3fe class=toggle>
<label for=section-aaef4b28e93ddde0053a8bd35b72d3fe class="flex justify-between"><a href=/zh-cn/docs/note/course/algorithms_part1/>算法-第一部分</a></label><ul></ul></li></ul></li><li><input type=checkbox id=section-e799e08a1a55553117545d5d0f207e3e class=toggle>
<label for=section-e799e08a1a55553117545d5d0f207e3e class="flex justify-between"><a role=button>Python</a></label><ul><li><input type=checkbox id=section-26a199d4fe1db5db29fee30b4f791172 class=toggle>
<label for=section-26a199d4fe1db5db29fee30b4f791172 class="flex justify-between"><a role=button>Snippets</a></label><ul><li><a href=/zh-cn/docs/note/pys/snippets/1_flow_control/>流程控制语句</a></li><li><a href=/zh-cn/docs/note/pys/snippets/2_data_list/>列表（list）</a></li><li><a href=/zh-cn/docs/note/pys/snippets/3_data_str/>字符串，元组和字典</a></li><li><a href=/zh-cn/docs/note/pys/snippets/4_func/>函数式编程</a></li><li><a href=/zh-cn/docs/note/pys/snippets/4_important_funcs/>4个重要的内置函数</a></li><li><a href=/zh-cn/docs/note/pys/snippets/5_file_io/>格式化输出与文件I/O</a></li><li><a href=/zh-cn/docs/note/pys/snippets/6_try_excep/>异常处理</a></li><li><a href=/zh-cn/docs/note/pys/snippets/7_scope/>命名空间与作用域</a></li><li><a href=/zh-cn/docs/note/pys/snippets/8_class_type/>类与对象</a></li><li><a href=/zh-cn/docs/note/pys/snippets/9_decoration/>闭包与装饰器</a></li><li><a href=/zh-cn/docs/note/pys/snippets/10_decoration_2/>装饰器2</a></li><li><a href=/zh-cn/docs/note/pys/snippets/11_threading/>线程模型</a></li><li><a href=/zh-cn/docs/note/pys/snippets/12_threading_lock/>线程-锁</a></li><li><a href=/zh-cn/docs/note/pys/snippets/13_threading_condition/>线程-条件</a></li><li><a href=/zh-cn/docs/note/pys/snippets/14_threading_semaphore/>线程-信号量</a></li><li><a href=/zh-cn/docs/note/pys/snippets/15_threading_event/>线程-事件</a></li></ul></li></ul></li><li><input type=checkbox id=section-a55bc121ab1723b9dedc870a0f128ac7 class=toggle>
<label for=section-a55bc121ab1723b9dedc870a0f128ac7 class="flex justify-between"><a role=button>Translations</a></label><ul><li><a href=/zh-cn/docs/note/translations/use-springboot-messagesource/>在SpringBoot中使用MessageSource</a></li><li><a href=/zh-cn/docs/note/translations/guide-to-logback-cn/>使用Logback记录日志</a></li><li><a href=/zh-cn/docs/note/translations/how2use-printf/>使用printf格式化输出</a></li></ul></li></ul></li></ul><ul><li><a href=/zh-cn/posts/>Blog</a></li><li><a href=/zh-cn/about/>About</a></li><li><a href=/zh-cn/archive/>Archive</a></li><li><a href=/zh-cn/memos/>Memo</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Redis Sentinel高可用实现</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><div id=toc-new><ul class=nav><li class=nav-item><a id=t1准备 href=javascript:void(0) onclick='return scrolly("1-准备"),!1'>1 准备</a><ul class=nav><li class=nav-item><a id=t11linux主机 href=javascript:void(0) onclick='return scrolly("11-linux主机"),!1'>1.1 linux主机</a></li><li class=nav-item><a id=t12Redis源码 href=javascript:void(0) onclick='return scrolly("12-redis-源码"),!1'>1.2 Redis 源码</a></li><li class=nav-item><a id=t13了解linux防火墙的基本知识 href=javascript:void(0) onclick='return scrolly("13-了解linux防火墙的基本知识"),!1'>1.3 了解linux防火墙的基本知识</a></li><li class=nav-item><a id=t14master，slave和sentinel href=javascript:void(0) onclick='return scrolly("14-master，slave和sentinel"),!1'>1.4 master，slave和sentinel</a></li></ul></li><li class=nav-item><a id=t2安装配置Redis href=javascript:void(0) onclick='return scrolly("2-安装配置redis"),!1'>2 安装配置Redis</a><ul class=nav><li class=nav-item><a id=t21编译源码 href=javascript:void(0) onclick='return scrolly("21-编译源码"),!1'>2.1 编译源码</a></li><li class=nav-item><a id=t22其他配置项 href=javascript:void(0) onclick='return scrolly("22-其他配置项"),!1'>2.2 其他配置项</a><ul class=nav><li class=nav-item><a id=t1复制redis二进制程序到系统环境变量 href=javascript:void(0) onclick='return scrolly("1-复制redis二进制程序到系统环境变量"),!1'>1. 复制redis二进制程序到系统环境变量</a></li><li class=nav-item><a id=t2将redis设置为开机启动： href=javascript:void(0) onclick='return scrolly("2-将redis设置为开机启动："),!1'>2. 将redis设置为开机启动：</a></li><li class=nav-item><a id=t3开放防火墙端口 href=javascript:void(0) onclick='return scrolly("3-开放防火墙端口"),!1'>3. 开放防火墙端口</a><ul class=nav><li class=nav-item><a id=t对于centOS7： href=javascript:void(0) onclick='return scrolly("对于centos-7："),!1'>对于centOS 7：</a></li><li class=nav-item><a id=tcentOS6 href=javascript:void(0) onclick='return scrolly("centos-6"),!1'>centOS 6</a></li></ul></li></ul></li><li class=nav-item><a id=t23配置文件redisconf href=javascript:void(0) onclick='return scrolly("23-配置文件redisconf"),!1'>2.3 配置文件redis.conf</a></li></ul></li><li class=nav-item><a id=t3启动redis href=javascript:void(0) onclick='return scrolly("3-启动redis"),!1'>3 启动redis</a></li><li class=nav-item><a id=t4使用rediscli href=javascript:void(0) onclick='return scrolly("4-使用redis-cli"),!1'>4 使用redis-cli</a></li><li class=nav-item><a id=t5关闭redisserver href=javascript:void(0) onclick='return scrolly("5-关闭redis-server"),!1'>5 关闭redis-server</a></li><li class=nav-item><a id=t6艺术就是复制 href=javascript:void(0) onclick='return scrolly("6-艺术就是复制"),!1'>6 艺术就是复制</a><ul class=nav><li class=nav-item><a id=t61配置redissalve href=javascript:void(0) onclick='return scrolly("61-配置redis-salve"),!1'>6.1 配置redis-salve</a><ul class=nav><li class=nav-item><a id=t611salve启动日志 href=javascript:void(0) onclick='return scrolly("611-salve启动日志"),!1'>6.1.1 salve启动日志</a></li><li class=nav-item><a id=t612验证主从数据同步 href=javascript:void(0) onclick='return scrolly("612-验证主从数据同步"),!1'>6.1.2 验证主从数据同步</a></li></ul></li><li class=nav-item><a id=t62配置redissentinel href=javascript:void(0) onclick='return scrolly("62-配置redis-sentinel"),!1'>6.2 配置redis-sentinel</a><ul class=nav><li class=nav-item><a id=t621sentinel启动日志 href=javascript:void(0) onclick='return scrolly("621-sentinel启动日志"),!1'>6.2.1 sentinel启动日志</a></li><li class=nav-item><a id=t622使用rediscli查看系统信息 href=javascript:void(0) onclick='return scrolly("622-使用redis-cli查看系统信息"),!1'>6.2.2 使用redis-cli查看系统信息</a></li><li class=nav-item><a id=t623模拟主备切换 href=javascript:void(0) onclick='return scrolly("623-模拟主备切换"),!1'>6.2.3 模拟主备切换</a></li></ul></li></ul></li><li class=nav-item><a id=t7结束语 href=javascript:void(0) onclick='return scrolly("7-结束语"),!1'>7 结束语</a></li></ul></div><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></aside></header><article class="markdown book-article"><h1><a href=/zh-cn/docs/craft/db/redis/build-redis-sentinel/>Redis Sentinel高可用实现</a></h1><div class="postmeta flex align-cneter" style=justify-content:center><div class="created flex align-cneter"><img src=/svg/calendar-event.svg class=book-icon alt>
<a title=' wangy325'>2019-08-14</a></div><div class="cates flex align-center"><img src=/svg/cates.svg class=book-icon alt>
<a href=/zh-cn/categories/redis/>Redis</a></div><div class="last-modified flex align center"><img src=/svg/edit.svg class=book-icon alt>
<a title=' wangy325 | 2024-08-07'>2024-08-07</a></div></div><p>Redis
<a href=https://raw.githubusercontent.com/antirez/redis/2.8/00-RELEASENOTES>v2.8</a> 之后提供了高可用实现<code>Redis Sentinel</code>，实现了<strong>主从复制</strong>以及<del>被动</del><strong>主备切换</strong>。
<a href=https://raw.githubusercontent.com/antirez/redis/3.0/00-RELEASENOTES>v3.0</a> 之后提供了分布式实现<code>Redis Cluster</code>。</p><p>本文讨论的是使用Sentinel搭建Redis高可用服务。</p><blockquote><p>If all redis and sentinel instances were deployed in same host, you just build a fake redis-sentinel <em>High-Availability</em> environment<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p></blockquote><h1 id=1-准备>1 准备
<a class=anchor href=#1-%e5%87%86%e5%a4%87>#</a></h1><h2 id=11-linux主机>1.1 linux主机
<a class=anchor href=#11-linux%e4%b8%bb%e6%9c%ba>#</a></h2><p>本文使用centOS7，需安装gcc：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>yum install gcc
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># or on ubuntu</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>apt-get install gcc
</span></span></code></pre></div><h2 id=12-redis-源码>1.2 Redis 源码
<a class=anchor href=#12-redis-%e6%ba%90%e7%a0%81>#</a></h2><p>本文使用
<a href=http://download.redis.io/releases/redis-4.0.11.tar.gz>v4.0.0.11</a>，版本号应大于2.8.0。</p><p>可以使用如下命令来获取指定版本的redis：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>wget http://download.redis.io/releases/redis-4.0.11.tar.gz
</span></span></code></pre></div><h2 id=13-了解linux防火墙的基本知识>1.3 了解linux防火墙的基本知识
<a class=anchor href=#13-%e4%ba%86%e8%a7%a3linux%e9%98%b2%e7%81%ab%e5%a2%99%e7%9a%84%e5%9f%ba%e6%9c%ac%e7%9f%a5%e8%af%86>#</a></h2><p>centOS7和centOS6使用不同的防火墙机制，前者使用<code>firewall</code>，后者使用<code>iptables</code>。</p><h2 id=14-masterslave和sentinel>1.4 master，slave和sentinel
<a class=anchor href=#14-masterslave%e5%92%8csentinel>#</a></h2><p>如果只想搭建一个单机(standalone)实例<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>来学习redis的数据结构，只需要阅读安装redis实例就好。</p><p>多个<code>standalone</code>加之合适的配置便组成了<code>master-slave</code>结构，一般而言，此时已经具备了「主从复制」的能力。</p><p>所谓<code>Sentinel</code>，并不是所谓「新技术」名词，只是一个用来做特定事情<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>的redis实例而已，故此我们也可以将其称作「服务」。如果需要搭建<code>Sentinel</code>服务，你需要先具备<code>master-slave</code>结构，也就是说，你至少需要搭建2个redis实例，并且将其中一台配置为另一台的slave。</p><p>了解更多关于redis-sentinel的相关内容，请参考
<a href=/zh-cn/>redis哨兵与高可用架构</a>。</p><img src=/img/master-slave-vs-sentinel.jpg alt=redis的主从模式和哨兵模式 width=400px position=center><h1 id=2-安装配置redis>2 安装配置Redis
<a class=anchor href=#2-%e5%ae%89%e8%a3%85%e9%85%8d%e7%bd%aeredis>#</a></h1><p>接下来会依次安装Redis并且配置多个Redis实例</p><h2 id=section-1>2.1 编译源码
<a class=anchor href=#section-1>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl>  tar -zxf redis-4.0.11.tar.gz
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=c1># compile source code</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=nb>cd</span> redis-4.0.11
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=c1># redis was recommended to install in /usr/local/redis</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  mkdir /usr/local/redis
</span></span><span class=line><span class=ln> 6</span><span class=cl>  make install <span class=nv>PREFIX</span><span class=o>=</span>/usr/local/redis
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=c1># ---</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=c1># if all operations are right, you will see the output below:</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># cd /usr/local/redis ; ll</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  total <span class=m>68</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=c1>#the redis executable binary file folder</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  drwxr-xr-x <span class=m>2</span> root root  <span class=m>4096</span> Aug  <span class=m>4</span> 15:19 bin         
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=c1># the (RDB)dump file of redis database, You can config where to save it later</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  -rw-r--r-- <span class=m>1</span> root root    <span class=m>93</span> Aug  <span class=m>4</span> 16:54 dump.rdb     
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=c1># the config file of a particular redis instance</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  -rw-r--r-- <span class=m>1</span> root root <span class=m>58905</span> Aug  <span class=m>7</span> 13:56 redis.conf  
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=o>[</span>root@shell redis<span class=o>]</span><span class=c1># cd /usr/local/redis/bin ; ll    </span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  total <span class=m>21876</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=c1># redis test tool</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  -rwxr-xr-x <span class=m>1</span> root root <span class=m>2452168</span> Aug  <span class=m>4</span> 15:19 redis-benchmark   
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=c1># redis AOF persistent check tool</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>  -rwxr-xr-x <span class=m>1</span> root root <span class=m>5775312</span> Aug  <span class=m>4</span> 15:19 redis-check-aof   
</span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=c1># redis RBD persistent check tool</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>  -rwxr-xr-x <span class=m>1</span> root root <span class=m>5775312</span> Aug  <span class=m>4</span> 15:19 redis-check-rdb   
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=c1># launch a redis client</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  -rwxr-xr-x <span class=m>2</span> root root <span class=m>2618192</span> Aug  <span class=m>4</span> 15:19 redis-cli         
</span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=c1># link to redis-server, launch a redis sentinel</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  lrwxrwxrwx <span class=m>1</span> root root      <span class=m>12</span> Aug  <span class=m>4</span> 15:19 redis-sentinel -&gt; redis-server   server
</span></span><span class=line><span class=ln>29</span><span class=cl>  <span class=c1>#launch a redis server(instance)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>  -rwxr-xr-x <span class=m>3</span> root root <span class=m>5775312</span> Aug  <span class=m>4</span> 15:19 redis-server  
</span></span></code></pre></div><p>两个<code>ll</code>命令显示了一个redis的全部内容。本文用到的几个文件分别是：</p><ul><li>redis.conf： 配置文件，绝对的主角，它的戏谁都抢不走</li><li>redis-server： 用于启动redis缓存服务</li><li>redis-client：command-line client tool</li></ul><h2 id=22-其他配置项>2.2 其他配置项
<a class=anchor href=#22-%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae%e9%a1%b9>#</a></h2><p>如果上述操作没有问题<del>这么简单也不会有问题</del>，理论上，一个<code>standalone</code>实例已经安装完成了，可以通过「命令 配置文件」的方式启动redis服务：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf
</span></span></code></pre></div><p>但是为了方便启动服务，还需要做一些额外的操作：</p><h3 id=1-复制redis二进制程序到系统环境变量>1. 复制redis二进制程序到系统环境变量
<a class=anchor href=#1-%e5%a4%8d%e5%88%b6redis%e4%ba%8c%e8%bf%9b%e5%88%b6%e7%a8%8b%e5%ba%8f%e5%88%b0%e7%b3%bb%e7%bb%9f%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=nb>cd</span> /usr/local/redis/bin/
</span></span><span class=line><span class=ln>2</span><span class=cl>cp redis-server redis-cli redis-sentinel /usr/local/bin
</span></span></code></pre></div><p>如此，启动redis的时候便不需要指定程序路径; 此时，已经可以直接在终端运行<code>redis-server</code>了</p><h3 id=2-将redis设置为开机启动>2. 将redis设置为开机启动：
<a class=anchor href=#2-%e5%b0%86redis%e8%ae%be%e7%bd%ae%e4%b8%ba%e5%bc%80%e6%9c%ba%e5%90%af%e5%8a%a8>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1># 安装完成后可以添加多个命令启动redis主从-哨兵系统</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;redis-server /usr/local/redis.conf&#34;</span> &gt;&gt; /etc/rc.local
</span></span></code></pre></div><h3 id=3-开放防火墙端口>3. 开放防火墙端口
<a class=anchor href=#3-%e5%bc%80%e6%94%be%e9%98%b2%e7%81%ab%e5%a2%99%e7%ab%af%e5%8f%a3>#</a></h3><blockquote><p>若主机未开启防火墙，则无需操作</p></blockquote><p>如果你的主机开启了防火墙，其他主机是无法连接上你的redis-server的，此时需要为其开放端口。</p><p>前面说到，centOS7和centOS6的防火墙机制不一样，需要分别处理。</p><p>若需知晓防火墙状态，请运行<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>systemctl status serviceName
</span></span></code></pre></div><p>centOS7 和centOS6的防火墙服务名分别为 <code>firewalld</code>和<code>iptables</code></p><h4 id=对于centos-7>对于centOS 7：
<a class=anchor href=#%e5%af%b9%e4%ba%8ecentos-7>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 查看开放端口</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># firewall-cmd --list-all</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>public
</span></span><span class=line><span class=ln> 4</span><span class=cl>  target: default
</span></span><span class=line><span class=ln> 5</span><span class=cl>  icmp-block-inversion: no
</span></span><span class=line><span class=ln> 6</span><span class=cl>  interfaces:
</span></span><span class=line><span class=ln> 7</span><span class=cl>  sources:
</span></span><span class=line><span class=ln> 8</span><span class=cl>  services: ssh dhcpv6-client http
</span></span><span class=line><span class=ln> 9</span><span class=cl>  ports: 6379/tcp
</span></span><span class=line><span class=ln>10</span><span class=cl>  protocols:
</span></span><span class=line><span class=ln>11</span><span class=cl>  masquerade: no
</span></span><span class=line><span class=ln>12</span><span class=cl>  forward-ports:
</span></span><span class=line><span class=ln>13</span><span class=cl>  source-ports:
</span></span><span class=line><span class=ln>14</span><span class=cl>  icmp-blocks:
</span></span><span class=line><span class=ln>15</span><span class=cl>  rich rules:
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1># 如果6379端口不在返回结果中，那么将6379添加到开放端口列表中</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># firewall-cmd --permanent --add-port=6379/tcp</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># firewall-cmd --reload</span>
</span></span></code></pre></div><h4 id=centos-6>centOS 6
<a class=anchor href=#centos-6>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1># 添加规则</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>iptables -I INPUT -p tcp -m tcp --dport <span class=m>6379</span> -j ACCEPT
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1># 保存规则</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>service iptables save
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=c1># 重启iptables</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>service iptables restart
</span></span></code></pre></div><h2 id=23-配置文件redisconf>2.3 配置文件redis.conf
<a class=anchor href=#23-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6redisconf>#</a></h2><p>在redis的
<a href=/zh-cn/#section-1>安装文件夹</a>内，有一个系统预配置文件<code>redis.conf</code>，我们需要修改此配置文件以满足需求。</p><p>以下列出了(redis-standalone)常见配置列表<sup id=fnref1:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=c1># redis进程是否以守护进程的方式(后台)运行(不以守护进程的方式运行会占用一个终端)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>daemonize yes
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># 指定redis进程的PID文件存放位置</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>pidfile /var/run/redis.pid
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># redis进程的端口号</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>port <span class=m>6379</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># 允许任何ipv4的主机连接；</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nb>bind</span> 0.0.0.0
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1># 客户端闲置多长时间(s)后关闭连接，默认此参数为0即关闭此功能</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>timeout <span class=m>300</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># redis日志级别，可用的级别有debug.verbose.notice.warning</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>loglevel verbose
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># log文件输出位置，如果进程以守护进程的方式运行，此处又将输出文件设置为stdout的话，</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1># 就会将日志信息输出到/dev/null里面去了</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>logfile /var/log/redis/redis_6379.log
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1># 设置数据库的数量，默认为0可以使用select &lt;dbid&gt;命令在连接上指定数据库id</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>databases <span class=m>16</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1># 保存db到磁盘，可配置多条，表示不同级别的数据改动</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=c1># 如下配置表示至少有一个key-value发生改动时，900s之后将其保存到磁盘；</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1># 如果至少有10个key-value发生改动，那么300s后将其保存到磁盘；</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>save <span class=m>900</span> <span class=m>1</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>save <span class=m>300</span> <span class=m>10</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1># 指定存储至本地数据库时是否压缩文件，默认为yes即启用存储</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>rdbcompression yes
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1># 指定本地数据库文件名</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>dbfilename dump.db
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1># 指定本地数据文件存放位置，以下配置表示保存在redis安装目录</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>dir ./
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1># 指定当本机为slave服务，配置为master的IP及端口，在redis启动的时候他会自动跟master进行数据同步</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>slaveof &lt;masterip&gt; &lt;masterport&gt;
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1># 当master设置了密码保护时，slave服务连接master的密码</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>masterauth &lt;master-password&gt;
</span></span><span class=line><span class=ln>33</span><span class=cl><span class=c1># 设置redis连接密码，如果配置了连接密码，客户端在连接redis是需要通过AUTH&lt;password&gt;命令</span>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1># 提供密码，默认关闭</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>requirepass password
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=c1># 设置同一时间最大客户连接数，默认无限制。redis可以同时连接的客户端数为redis程序可以打开的最大</span>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1># 文件描述符，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的</span>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=c1># 连接并向客户端返回 max number of clients reached 错误信息</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>maxclients <span class=m>128</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1># 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除</span>
</span></span><span class=line><span class=ln>41</span><span class=cl><span class=c1># 已到期或即将到期的Key。当此方法处理后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以</span>
</span></span><span class=line><span class=ln>42</span><span class=cl><span class=c1># 进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>maxmemory &lt;bytes&gt;
</span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1># 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可</span>
</span></span><span class=line><span class=ln>45</span><span class=cl><span class=c1># 能会在断电时导致一段时间内的数据丢失。因为redis本身同步数据文件是按上面save条件来同步的，所以</span>
</span></span><span class=line><span class=ln>46</span><span class=cl><span class=c1># 有的数据会在一段时间内只存在于内存中。默认为no。</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>appendonly no
</span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1># 指定跟新日志文件名默认为appendonly.aof</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>appendfilename appendonly.aof
</span></span><span class=line><span class=ln>50</span><span class=cl><span class=c1># 指定更新日志的条件，有三个可选参数 - no：表示等操作系统进行数据缓存同步到磁盘(快)，always：表示每次</span>
</span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1># 更新操作后手动调用fsync()将数据写到磁盘(慢，安全)， everysec：表示每秒同步一次(折衷，默认值)；</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>appendfsync everysec
</span></span></code></pre></div><p>⚠️注意：关于<code>bind</code>指令的描述<del>可以配置指定ip来允许指定连接，多个ip使用空格分隔</del>，关于bind的意义，参考
<a href=https://blog.csdn.net/hel12he/article/details/46911159>redis配置外网访问</a></p><h1 id=3-启动redis>3 启动redis
<a class=anchor href=#3-%e5%90%af%e5%8a%a8redis>#</a></h1><p>redis.conf文件配置无差的话，即可指定配置文件启动redis服务：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl>redis-server /usr/local/redis/redis.conf
</span></span></code></pre></div><p>启动日志：</p><pre tabindex=0><code>27552:C 04 Aug 16:12:58.912 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
27552:C 04 Aug 16:12:58.912 # Redis version=4.0.11, bits=64, commit=00000000,
 modified=0, pid=27552, just started
27552:C 04 Aug 16:12:58.912 # Configuration loaded
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 4.0.11 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6379
 |    `-._   `._    /     _.-&#39;    |     PID: 27553
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                           
              `-.__.-&#39;                                               

27553:M 04 Aug 16:12:58.915 # WARNING: The TCP backlog setting of 511 cannot
be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
27553:M 04 Aug 16:12:58.916 # Server initialized
27553:M 04 Aug 16:12:58.916 # WARNING overcommit_memory is set to 0! Background
save may fail under low memory condition. To fix this issue add
&#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the
command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.
27553:M 04 Aug 16:12:58.916 # WARNING you have Transparent Huge Pages (THP)
 support enabled in your kernel. This will create latency and memory usage
 issues with Redis. To fix this issue run the command
 &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it
  to your /etc/rc.local in order to retain the setting after a reboot.
  Redis must be restarted after THP is disabled.
27553:M 04 Aug 16:12:58.916 * Ready to accept connections
</code></pre><p>可以看到，一个<code>standalon</code>已经运行成功，但是有3个WARNING[^V5]:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl>WARNING: The TCP backlog setting of <span class=m>511</span> cannot be enforced because
</span></span><span class=line><span class=ln> 2</span><span class=cl> /proc/sys/net/core/somaxconn is <span class=nb>set</span> to the lower value of 128.
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># solution</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># echo 511 &gt;/proc/sys/net/core/somaxconn</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># echo &#34;net.core.somaxconn = 551&#34; &gt;&gt; /etc/sysctl.conf</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>WARNING overcommit_memory is <span class=nb>set</span> to 0! Background save may fail under low
</span></span><span class=line><span class=ln> 8</span><span class=cl>memory condition. To fix this issue add <span class=s1>&#39;vm.overcommit_memory = 1&#39;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>to /etc/sysctl.conf and <span class=k>then</span> reboot or run the <span class=nb>command</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=s1>&#39;sysctl vm.overcommit_memory=1&#39;</span> <span class=k>for</span> this to take effect.
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1>#solution</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># echo 1 &gt; /proc/sys/vm/overcommit_memory</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># echo &#34;vm.overcommit_memory=1&#34; &gt;&gt; /etc/sysctl.conf</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>WARNING you have Transparent Huge Pages <span class=o>(</span>THP<span class=o>)</span> support enabled in your kernel.
</span></span><span class=line><span class=ln>16</span><span class=cl>This will create latency and memory usage issues with Redis. To fix this issue
</span></span><span class=line><span class=ln>17</span><span class=cl> run the <span class=nb>command</span> <span class=s1>&#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39;</span> as
</span></span><span class=line><span class=ln>18</span><span class=cl> root, and add it to your /etc/rc.local in order to retain the setting after a
</span></span><span class=line><span class=ln>19</span><span class=cl>  reboot. Redis must be restarted after THP is disabled.
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1>#solution</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># vi /etc/rc.local</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=k>if</span> <span class=nb>test</span> -f /sys/kernel/mm/transparent_hugepage/enabled<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>   <span class=nb>echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=k>if</span> <span class=nb>test</span> -f /sys/kernel/mm/transparent_hugepage/defrag<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>   <span class=nb>echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=k>fi</span>    
</span></span></code></pre></div><h1 id=4-使用redis-cli>4 使用redis-cli
<a class=anchor href=#4-%e4%bd%bf%e7%94%a8redis-cli>#</a></h1><p>redis服务启动成功之后，便可以通过<code>redis-cli</code>与服务进行交互。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 连接redis-server，若-h和-p参数缺省，则默认连接localhost:6379</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>redis-cli -h 127.0.0.1 -p <span class=m>6379</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>127.0.0.1:6379&gt;
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># 若redis-server requirepass设置了密码，那么需要认证</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>127.0.0.1:6379&gt; auth yourpassword
</span></span><span class=line><span class=ln> 6</span><span class=cl>OK
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># ping-PONG说明redis服务正常</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>127.0.0.1:6379&gt; ping
</span></span><span class=line><span class=ln> 9</span><span class=cl>127.0.0.1:6379&gt; PONG
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># 获取帮助</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>127.0.0.1:6379&gt; <span class=nb>help</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>redis-cli 4.0.11
</span></span><span class=line><span class=ln>13</span><span class=cl>To get <span class=nb>help</span> about Redis commands type:
</span></span><span class=line><span class=ln>14</span><span class=cl>      <span class=s2>&#34;help @&lt;group&gt;&#34;</span> to get a list of commands in &lt;group&gt;
</span></span><span class=line><span class=ln>15</span><span class=cl>      <span class=s2>&#34;help &lt;command&gt;&#34;</span> <span class=k>for</span> <span class=nb>help</span> on &lt;command&gt;
</span></span><span class=line><span class=ln>16</span><span class=cl>      <span class=s2>&#34;help &lt;tab&gt;&#34;</span> to get a list of possible <span class=nb>help</span> topics
</span></span><span class=line><span class=ln>17</span><span class=cl>      <span class=s2>&#34;quit&#34;</span> to <span class=nb>exit</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>To <span class=nb>set</span> redis-cli preferences:
</span></span><span class=line><span class=ln>20</span><span class=cl>      <span class=s2>&#34;:set hints&#34;</span> <span class=nb>enable</span> online hints
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=s2>&#34;:set nohints&#34;</span> disable online hints
</span></span><span class=line><span class=ln>22</span><span class=cl>Set your preferences in ~/.redisclirc
</span></span><span class=line><span class=ln>23</span><span class=cl>127.0.0.1:6379&gt; <span class=nb>help</span> shutdown
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>  SHUTDOWN <span class=o>[</span>NOSAVE<span class=p>|</span>SAVE<span class=o>]</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  summary: Synchronously save the dataset to disk and <span class=k>then</span> shut down the server
</span></span><span class=line><span class=ln>27</span><span class=cl>  since: 1.0.0
</span></span><span class=line><span class=ln>28</span><span class=cl>  group: server
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>127.0.0.1:6379&gt;
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1># 退出客户端</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>127.0.0.1:6379&gt; <span class=nb>exit</span>
</span></span></code></pre></div><h1 id=5-关闭redis-server>5 关闭redis-server
<a class=anchor href=#5-%e5%85%b3%e9%97%adredis-server>#</a></h1><blockquote><p>⚠️不要使用kill -9 pid关闭redis server，这样会可能会丢失数据完整性</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1>#关闭redis-server 可选参数nosave|save意为关闭服务之前是否保存数据到磁盘</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>127.0.0.1:6379&gt; shutdown <span class=o>[</span>nosave<span class=p>|</span>save<span class=o>]</span>
</span></span></code></pre></div><h1 id=6-艺术就是复制>6 艺术就是复制
<a class=anchor href=#6-%e8%89%ba%e6%9c%af%e5%b0%b1%e6%98%af%e5%a4%8d%e5%88%b6>#</a></h1><blockquote><p>以下配置是基于一台服务器的演示，如果要部署高可用环境，需要在不同的服务器上安装redis并作如下配置</p></blockquote><p>经过上述操作，一个redis-standalone服务就配置好了，如果要将redis系统高可用，只需要「复制」就好了。</p><p>前面说过，<code>redis-server</code>是通过<strong>可执行文件 + 配置文件</strong>的方式启动，可执行文件已经解压得到，那么只需要复制配置文件就可以了。</p><p>以下是本次slave和sentinel的配置：</p><table><thead><tr><th>Role</th><th style=text-align:center>Address</th><th style=text-align:left>Port</th></tr></thead><tbody><tr><td><strong>Master</strong></td><td style=text-align:center>localhost</td><td style=text-align:left>6379</td></tr><tr><td>Slave</td><td style=text-align:center>localhost</td><td style=text-align:left>16379, 26379</td></tr><tr><td>Sentinel</td><td style=text-align:center>localhost</td><td style=text-align:left>6380, 16380, 26380</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1># current workDir</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nb>cd</span> /usr/local
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1># 创建文件夹存放slave和sentinel配置文件</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>mkdir redis-slave  redis-sentinel
</span></span><span class=line><span class=ln>5</span><span class=cl>cp -r redis/redis.conf redis-slave
</span></span><span class=line><span class=ln>6</span><span class=cl>cp -r redis/redis.conf redis-sentinel
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=c1># slave配置文件</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>mv redis-slave/redis.conf redis-slave/slave-16379.conf
</span></span></code></pre></div><h2 id=61-配置redis-salve>6.1 配置redis-salve
<a class=anchor href=#61-%e9%85%8d%e7%bd%aeredis-salve>#</a></h2><p>slave的配置大抵和standalone一致，需要注意配置几个地方：</p><ul><li><code>logfile</code>的保存地址配置自行配置</li><li><code>masterauth</code>和<code>requirepass</code>配置master的密码</li><li><code>slaveof</code>指明了其是哪个「主」的「从」</li><li><code>slave-read-only</code>指明从服务器只读</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl>vim redis-slave/slave-16379.conf
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>&lt;&lt;&lt;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    daemonize yes
</span></span><span class=line><span class=ln> 4</span><span class=cl>    pidfile /var/run/redis-16379.pid
</span></span><span class=line><span class=ln> 5</span><span class=cl>    logfile /var/log/redis/redis-16379.log
</span></span><span class=line><span class=ln> 6</span><span class=cl>    port <span class=m>16379</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nb>bind</span> 0.0.0.0
</span></span><span class=line><span class=ln> 8</span><span class=cl>    timeout <span class=m>300</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    databases <span class=m>16</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    dbfilename dump-16379.db
</span></span><span class=line><span class=ln>11</span><span class=cl>    dir ./
</span></span><span class=line><span class=ln>12</span><span class=cl>    masterauth yourpassword
</span></span><span class=line><span class=ln>13</span><span class=cl>    requirepass yourpassword
</span></span><span class=line><span class=ln>14</span><span class=cl>    slave-read-only yes
</span></span><span class=line><span class=ln>15</span><span class=cl>    slaveof 127.0.0.1 <span class=m>6379</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln>1</span><span class=cl><span class=c1># 再多配一个slave</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>cp redis-slave/slave-16379.conf redis-slave/slave-26379.conf
</span></span></code></pre></div><p>同样地，只需要更改部分配置内容（端口，文件名）就可以了。</p><h3 id=611-salve启动日志>6.1.1 salve启动日志
<a class=anchor href=#611-salve%e5%90%af%e5%8a%a8%e6%97%a5%e5%bf%97>#</a></h3><p>以下是配置成功的slave启动日志：</p><pre tabindex=0><code>30463:C 05 Aug 11:33:34.536 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
30463:C 05 Aug 11:33:34.537 # Redis version=4.0.11, bits=64, commit=00000000,
modified=0, pid=30463, just started
30463:C 05 Aug 11:33:34.537 # Configuration loaded
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 4.0.11 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 26379
 |    `-._   `._    /     _.-&#39;    |     PID: 30464
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                      
              `-.__.-&#39;                                               

30464:S 05 Aug 11:33:34.539 # Server initialized
30464:S 05 Aug 11:33:34.539 * Ready to accept connections
# 注意以下输出：
30464:S 05 Aug 11:33:34.539 * Connecting to MASTER 127.0.0.1:6379
30464:S 05 Aug 11:33:34.539 * MASTER &lt;-&gt; SLAVE sync started
30464:S 05 Aug 11:33:34.539 * Non blocking connect for SYNC fired the event.
30464:S 05 Aug 11:33:34.539 * Master replied to PING, replication can continue...
30464:S 05 Aug 11:33:34.539 * Partial resynchronization not possible
 (no cached master)
30464:S 05 Aug 11:33:34.540 * Full resync from master:
4e99dfc708f2035b3b39f34796434de5889f667b:308
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: receiving 177 bytes from master
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: Flushing old data
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: Loading DB in memory
30464:S 05 Aug 11:33:34.543 * MASTER &lt;-&gt; SLAVE sync: Finished with success
</code></pre><p>slave的启动日志有几个信息值得关注：</p><ul><li>redis启动警告信息消除，说明我们之前的配置生效了；</li><li>slave server 初始化成功之后，便开始连接master；</li><li>master 连接成功之后，便开始从主数据库同步数据；</li><li>之后，从数据库一直监听<sup><a>机制</a></sup>主数据库的改动并同步数据</li></ul><h3 id=612-验证主从数据同步>6.1.2 验证主从数据同步
<a class=anchor href=#612-%e9%aa%8c%e8%af%81%e4%b8%bb%e4%bb%8e%e6%95%b0%e6%8d%ae%e5%90%8c%e6%ad%a5>#</a></h3><p>可以通过在主数据库写入数据，通过从服务器读取数据来验证主从关系是否正常。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=o>[</span>root@shell ~<span class=o>]</span><span class=c1># redis-cli -h localhost -p 6379</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>localhost:6379&gt; auth yourpassword
</span></span><span class=line><span class=ln> 3</span><span class=cl>OK
</span></span><span class=line><span class=ln> 4</span><span class=cl>localhost:16379&gt; get count
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=s2>&#34;6&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>localhost:16379&gt; decr count
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=o>(</span>integer<span class=o>)</span> <span class=m>5</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>localhost:16379&gt; <span class=nb>exit</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>[</span>root@ ~<span class=o>]</span><span class=c1># redis-cli -h localhost -p 16379</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>localhost:6379&gt; auth yourpassword
</span></span><span class=line><span class=ln>11</span><span class=cl>OK
</span></span><span class=line><span class=ln>12</span><span class=cl>localhost:6379&gt; get count
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=s2>&#34;5&#34;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>localhost:6379&gt; incr count
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=o>(</span>error<span class=o>)</span> READONLY You can<span class=se>\&#39;</span>t write against a <span class=nb>read</span> only slave.
</span></span></code></pre></div><p>可以看到，主服务器将count值自减1之后，从服务器获取的count值也是自减后的值；同时，如果在从服务器上对count进行自增操作，会得到一条</p><pre tabindex=0><code>(error) READONLY You can&#39;t write against a read only slave.
</code></pre><p>的错误消息，说明</p><ul><li><p>端口16379的redis服务是slave；</p></li><li><p>我们配置的从服务器只读生效了</p></li></ul><p>以上，即可完成配置经典的一主多备的redis服务部署。</p><h2 id=62-配置redis-sentinel>6.2 配置redis-sentinel
<a class=anchor href=#62-%e9%85%8d%e7%bd%aeredis-sentinel>#</a></h2><p>同<code>slave</code>的配置一样，复制配置文件，少许改动即可，以下列出了<code>sentinel</code>的异于<code>slave</code>的配置项<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 哨兵sentinel监控的redis主节点的</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>## quorum：当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了  </span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;  </span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>sentinel monitor master 127.0.0.1 <span class=m>6379</span> <span class=m>2</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1># 当在Redis实例中开启了requirepass &lt;foobared&gt;，所有连接Redis实例的客户端都要提供密码</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;  </span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>sentinel auth-pass master yourpassword  
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># 指定主节点应答哨兵sentinel的最大时间间隔，超过这个时间，哨兵主观上认为主节点下线，默认30秒  </span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>sentinel down-after-milliseconds master <span class=m>30000</span>  
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1># 指定了在发生failover主备切换时，最多可以有多少个slave同时对新的master进行同步。</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1># 这个数字越小，完成failover所需的时间就越长；反之，但是如果这个数字越大，就意味着越多的</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1># slave因为replication而不可用。可以通过将这个值设为1，来保证每次只有一个slave，处于不能</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1># 处理命令请求的状态。</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>sentinel parallel-syncs master <span class=m>1</span>  
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1># 故障转移的超时时间failover-timeout，默认三分钟，可以用在以下这些方面：</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1>## 1. 同一个sentinel对同一个master两次failover之间的间隔时间。  </span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1>## 2. 当一个slave从一个错误的master那里同步数据时开始，直到slave被纠正为从正确的master</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1>#   那里同步数据时结束。  </span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1>## 3. 当想要取消一个正在进行的failover时所需要的时间。</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1>## 4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1>#   slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来同步数据了</span>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;  </span>
</span></span><span class=line><span class=ln>29</span><span class=cl>sentinel failover-timeout master <span class=m>180000</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=ln> 1</span><span class=cl><span class=c1># sentinel配置文件</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>mv redis-sentinel/redis.conf redis-sentinel/sentinel-6380.conf
</span></span><span class=line><span class=ln> 3</span><span class=cl>vim redis-sentinel/sentinel-6380.conf
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=o>&lt;&lt;&lt;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>protected-mode no
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nb>bind</span> 0.0.0.0
</span></span><span class=line><span class=ln> 7</span><span class=cl>port <span class=m>16380</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>daemonize yes
</span></span><span class=line><span class=ln> 9</span><span class=cl>sentinel monitor master 127.0.0.1 <span class=m>6379</span> <span class=m>2</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>sentinel down-after-milliseconds master <span class=m>5000</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>sentinel failover-timeout master <span class=m>180000</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>sentinel parallel-syncs master <span class=m>1</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>sentinel auth-pass master yourpassword
</span></span><span class=line><span class=ln>14</span><span class=cl>logfile /var/log/redis/sentinel-16380.log
</span></span></code></pre></div><p>同理，可以再配置其他2个<code>sentinel</code>服务。</p><h3 id=621-sentinel启动日志>6.2.1 sentinel启动日志
<a class=anchor href=#621-sentinel%e5%90%af%e5%8a%a8%e6%97%a5%e5%bf%97>#</a></h3><p>启动sentinel<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell><span class=line><span class=ln>1</span><span class=cl>redis-sentinel /usr/local/redis-sentinel/sentinel-6380.conf
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># 或者</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>redis-server /usr/local/redis-sentinel/sentinel-6380.conf --sentinel
</span></span></code></pre></div><p>以下是配置成功的<code>sentinel</code>启动日志其一</p><pre tabindex=0><code>8550:X 05 Aug 14:29:38.696 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
8550:X 05 Aug 14:29:38.696 # Redis version=4.0.11, bits=64, commit=00000000,
 modified=0, pid=8550, just started
8550:X 05 Aug 14:29:38.696 # Configuration loaded
                _._                                                  
           _.-``__ &#39;&#39;-._                                             
      _.-``    `.  `_.  &#39;&#39;-._           Redis 4.0.11 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                   
 (    &#39;      ,       .-`  | `,    )     Running in sentinel mode
 |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6380
 |    `-._   `._    /     _.-&#39;    |     PID: 8551
  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io        
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
 |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
 |    `-._`-._        _.-&#39;_.-&#39;    |                                  
  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
      `-._    `-.__.-&#39;    _.-&#39;                                       
          `-._        _.-&#39;                                           
              `-.__.-&#39;                                               

8551:X 05 Aug 14:29:38.702 # Sentinel ID is
c3776869c9bc3998e45158d3933d8e7b7c60ea84
8551:X 05 Aug 14:29:38.702 # +monitor master master 127.0.0.1 6379 quorum 2
</code></pre><p>通过观查启动日志，我们可以看到：</p><ul><li>此实例的启动模式为<code>sentinel mode</code>，端口为6380</li><li><code>sentinel</code>已经成功监控<code>master</code>端口6379了</li></ul><p>全部哨兵系统搭建起来并运行之后，再去查看<code>sentinel</code>的配置文件，会有如下自动配置的内容：</p><pre tabindex=0><code># Generated by CONFIG REWRITE
sentinel auth-pass master yourpassword
sentinel config-epoch master 1
sentinel leader-epoch master 1
sentinel known-slave master 127.0.0.1 16379
sentinel known-slave master 127.0.0.1 26379
sentinel known-sentinel master 127.0.0.1 26380 e615ce
sentinel known-sentinel master 127.0.0.1 6380 dcc9d7
sentinel current-epoch 1
</code></pre><p>上面的配置列出了</p><ul><li>主服务器的密码</li><li>以及当前世代（每发生一次主备切换称为一次世代，epoch加1）</li><li>当前所有从服务器的地址和端口信息</li><li>当前所以其他已知哨兵的端口和id信息</li></ul><h3 id=622-使用redis-cli查看系统信息>6.2.2 使用redis-cli查看系统信息
<a class=anchor href=#622-%e4%bd%bf%e7%94%a8redis-cli%e6%9f%a5%e7%9c%8b%e7%b3%bb%e7%bb%9f%e4%bf%a1%e6%81%af>#</a></h3><p><code>sentinel</code>哨兵系统搭建起来之后，可以任一通过客户端查看系统内的实例信息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell><span class=line><span class=ln> 1</span><span class=cl>127.0.0.1:16380&gt; sentinel master master
</span></span><span class=line><span class=ln> 2</span><span class=cl> 1<span class=o>)</span> <span class=s2>&#34;name&#34;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl> 2<span class=o>)</span> <span class=s2>&#34;master&#34;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl> 3<span class=o>)</span> <span class=s2>&#34;ip&#34;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl> 4<span class=o>)</span> <span class=s2>&#34;127.0.0.1&#34;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl> 5<span class=o>)</span> <span class=s2>&#34;port&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl> 6<span class=o>)</span> <span class=s2>&#34;6379&#34;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl> 7<span class=o>)</span> <span class=s2>&#34;runid&#34;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl> 8<span class=o>)</span> <span class=s2>&#34;dfefe0ba7435f7c2c193698f17b7e46f7450d5ce&#34;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl> 9<span class=o>)</span> <span class=s2>&#34;flags&#34;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>10<span class=o>)</span> <span class=s2>&#34;master&#34;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>...
</span></span><span class=line><span class=ln>13</span><span class=cl>127.0.0.1:16380&gt; sentinel slaves master
</span></span><span class=line><span class=ln>14</span><span class=cl>1<span class=o>)</span>  1<span class=o>)</span> <span class=s2>&#34;name&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    2<span class=o>)</span> <span class=s2>&#34;127.0.0.1:16379&#34;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    3<span class=o>)</span> <span class=s2>&#34;ip&#34;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    4<span class=o>)</span> <span class=s2>&#34;127.0.0.1&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    5<span class=o>)</span> <span class=s2>&#34;port&#34;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    6<span class=o>)</span> <span class=s2>&#34;16379&#34;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    7<span class=o>)</span> <span class=s2>&#34;runid&#34;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    8<span class=o>)</span> <span class=s2>&#34;fdda882f98724c46359a4deb9390b6ae4de13320&#34;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    9<span class=o>)</span> <span class=s2>&#34;flags&#34;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>   10<span class=o>)</span> <span class=s2>&#34;slave&#34;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl> ...
</span></span><span class=line><span class=ln>25</span><span class=cl>2<span class=o>)</span>  1<span class=o>)</span> <span class=s2>&#34;name&#34;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>    2<span class=o>)</span> <span class=s2>&#34;127.0.0.1:26379&#34;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>    3<span class=o>)</span> <span class=s2>&#34;ip&#34;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>    4<span class=o>)</span> <span class=s2>&#34;127.0.0.1&#34;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    5<span class=o>)</span> <span class=s2>&#34;port&#34;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    6<span class=o>)</span> <span class=s2>&#34;26379&#34;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    7<span class=o>)</span> <span class=s2>&#34;runid&#34;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    8<span class=o>)</span> <span class=s2>&#34;4a2c286c0c99c3a1202eec142599193a85671f6c&#34;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    9<span class=o>)</span> <span class=s2>&#34;flags&#34;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>   10<span class=o>)</span> <span class=s2>&#34;slave&#34;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>...
</span></span></code></pre></div><h3 id=623-模拟主备切换>6.2.3 模拟主备切换
<a class=anchor href=#623-%e6%a8%a1%e6%8b%9f%e4%b8%bb%e5%a4%87%e5%88%87%e6%8d%a2>#</a></h3><p>哨兵的存在就是为了解决<code>master-slave</code>系统中由于<code>master</code>宕机引起的系统瘫痪问题。</p><p>在哨兵系统中，一旦哨兵发现当前<code>master</code>宕机，哨兵会在余下的<code>slaves</code>中选举一个「继任」为新一代的<code>master</code>，从而保证系统的高可用。</p><p>现在我们通过主动关闭当前<code>master</code>服务的方式来模拟<code>master</code>宕机，看看哨兵会做什么：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 关闭master服务</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>redis-cli -p <span class=m>6379</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>127.0.0.1:6379&gt; auth yourpassword
</span></span><span class=line><span class=ln> 4</span><span class=cl>OK
</span></span><span class=line><span class=ln> 5</span><span class=cl>127.0.0.1:6379&gt; shutdown save
</span></span><span class=line><span class=ln> 6</span><span class=cl>127.0.0.1:6379&gt; <span class=nb>exit</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># 查看sentinel日志</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>less /var/log/redis/sentinel-6380.log
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>&lt;&lt;&lt;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:02.326 <span class=c1># +sdown master master 127.0.0.1 6379</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:02.389 <span class=c1># +new-epoch 1</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:02.391 <span class=c1># +vote-for-leader 503d5371452f8e110df0f12c236da3e51b55b03a 1</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:03.444 <span class=c1># +odown master master 127.0.0.1 6379 #quorum 3/2</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:03.444 <span class=c1># Next failover delay: I will not start a failover before Fri Aug 23 17:14:38 2019</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:03.488 <span class=c1># +config-update-from sentinel 503d5371452f8e110df0f12c236da3e51b55b03a 172.16.16.203 16380 @ master 127.0.0.1 6379</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:03.488 <span class=c1># +switch-master master 127.0.0.1 6379 127.0.0.1 26379</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:03.488 * +slave slave 127.0.0.1:16379 127.0.0.1 <span class=m>16379</span> @ master 127.0.0.1 <span class=m>26379</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:03.488 * +slave slave 127.0.0.1:6379 127.0.0.1 <span class=m>6379</span> @ master 127.0.0.1 <span class=m>26379</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>29649:X <span class=m>23</span> Aug 17:14:08.536 <span class=c1># +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ master 127.0.0.1 26379</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>29649:X <span class=m>23</span> Aug 17:15:42.868 <span class=c1># -sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ master 127.0.0.1 26379</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>29649:X <span class=m>23</span> Aug 17:15:52.888 * +convert-to-slave slave 127.0.0.1:6379 127.0.0.1 <span class=m>6379</span> @ master 127.0.0.1 <span class=m>26379</span>
</span></span></code></pre></div><p>通过24行<code>sentinel</code>日志，我们可以看到的信息有哪些呢？</p><ul><li>master<strong>主观下线</strong><sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>；</li><li>系统进入新世代；</li><li>3/2投票认为master下线，master<strong>客观下线</strong><sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>；</li><li>切换主服务器：从6379切换为26379；</li><li>同时6379和16379切换为26379的从节点</li></ul><p>此时，我们如果查看redis的配置文件，会发现原<code>6379</code>的主服务器配置文件多了一行</p><pre tabindex=0><code>slaveof 127.0.0.1 26379
</code></pre><p>同时，<code>16379</code>和<code>26379</code>端口的服务的<code>slaveof</code>配置项也作了相应修改。</p><h1 id=7-结束语>7 结束语
<a class=anchor href=#7-%e7%bb%93%e6%9d%9f%e8%af%ad>#</a></h1><p>至此，基于<code>sentinel</code>的redis高可用集群就搭建完成了。虽然篇幅较长，实际上搭建一个这样的系统的逻辑是比较简单的。</p><p>主要易于混淆的是6不个redis实例的配置，细心点就好了。</p><p>想用好这个高可用系统，你可能还需要了解更多关于<code>sentinel</code>的内容。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>本文是在所有服务均配置完成之后所作的记录，并非同步记录，部分操作可能存在错误&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>下文会多次提到实例这个概念，它在本文中指一个运行的Redis数据库服务&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>监控master状态，如果宕机，则执行主备切换&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://juejin.im/post/5b76e732f265da4376203849#heading-11>搭建redis单机服务</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://juejin.im/post/5b7d226a6fb9a01a1e01ff64>redis哨兵与高可用</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://www.mankier.com/1/redis-server>redis-server man page</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>仅当前哨兵接收不到master的心跳，称为主观下线&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>经过投票之后，满足配置个数的哨兵认为master下线，则master被认为客观下线，触发主备切换&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><div class=next-prev><hr><div class="page-navi flex" id=pagenavi><div class=pre-page>←
<a href=https://wangy325.github.io/zh-cn/docs/craft/db/redis/redis-all/>redis必知必会(转)</a></div><div class=next-page><a href=https://wangy325.github.io/zh-cn/docs/craft/db/redis/deploy-redis-cluster-with-docker/>使用docker镜像快速搭建redis集群开发环境</a> →</div></div></div><section class=related><hr></section><div class=book-comments><div class=giscus-thread></div><script src=https://giscus.app/client.js data-repo=wangy325/wangy325.github.io data-repo-id=R_kgDOHhhDZg data-category=Announcements data-category-id=DIC_kwDOHhhDZs4ChbMn data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=noborder_light data-loading=lazy data-lang=zh-CN crossorigin=anonymous async></script></div><div class=copyright><hr class=cline><p>Notes and Memos by wangy325
<a href=https://creativecommons.org/licenses/by/4.0/deed.en title="Creative Commons Attribution">&copy; CC BY 4.0</a></p><p>2019-2024. Powered by
<a href=https://github.com/alex-shpak/hugo-book>Hugo Book</a>
Presented by Github.</p></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><div id=toc-new><ul class=nav><li class=nav-item><a id=t1准备 href=javascript:void(0) onclick='return scrolly("1-准备"),!1'>1 准备</a><ul class=nav><li class=nav-item><a id=t11linux主机 href=javascript:void(0) onclick='return scrolly("11-linux主机"),!1'>1.1 linux主机</a></li><li class=nav-item><a id=t12Redis源码 href=javascript:void(0) onclick='return scrolly("12-redis-源码"),!1'>1.2 Redis 源码</a></li><li class=nav-item><a id=t13了解linux防火墙的基本知识 href=javascript:void(0) onclick='return scrolly("13-了解linux防火墙的基本知识"),!1'>1.3 了解linux防火墙的基本知识</a></li><li class=nav-item><a id=t14master，slave和sentinel href=javascript:void(0) onclick='return scrolly("14-master，slave和sentinel"),!1'>1.4 master，slave和sentinel</a></li></ul></li><li class=nav-item><a id=t2安装配置Redis href=javascript:void(0) onclick='return scrolly("2-安装配置redis"),!1'>2 安装配置Redis</a><ul class=nav><li class=nav-item><a id=t21编译源码 href=javascript:void(0) onclick='return scrolly("21-编译源码"),!1'>2.1 编译源码</a></li><li class=nav-item><a id=t22其他配置项 href=javascript:void(0) onclick='return scrolly("22-其他配置项"),!1'>2.2 其他配置项</a><ul class=nav><li class=nav-item><a id=t1复制redis二进制程序到系统环境变量 href=javascript:void(0) onclick='return scrolly("1-复制redis二进制程序到系统环境变量"),!1'>1. 复制redis二进制程序到系统环境变量</a></li><li class=nav-item><a id=t2将redis设置为开机启动： href=javascript:void(0) onclick='return scrolly("2-将redis设置为开机启动："),!1'>2. 将redis设置为开机启动：</a></li><li class=nav-item><a id=t3开放防火墙端口 href=javascript:void(0) onclick='return scrolly("3-开放防火墙端口"),!1'>3. 开放防火墙端口</a><ul class=nav><li class=nav-item><a id=t对于centOS7： href=javascript:void(0) onclick='return scrolly("对于centos-7："),!1'>对于centOS 7：</a></li><li class=nav-item><a id=tcentOS6 href=javascript:void(0) onclick='return scrolly("centos-6"),!1'>centOS 6</a></li></ul></li></ul></li><li class=nav-item><a id=t23配置文件redisconf href=javascript:void(0) onclick='return scrolly("23-配置文件redisconf"),!1'>2.3 配置文件redis.conf</a></li></ul></li><li class=nav-item><a id=t3启动redis href=javascript:void(0) onclick='return scrolly("3-启动redis"),!1'>3 启动redis</a></li><li class=nav-item><a id=t4使用rediscli href=javascript:void(0) onclick='return scrolly("4-使用redis-cli"),!1'>4 使用redis-cli</a></li><li class=nav-item><a id=t5关闭redisserver href=javascript:void(0) onclick='return scrolly("5-关闭redis-server"),!1'>5 关闭redis-server</a></li><li class=nav-item><a id=t6艺术就是复制 href=javascript:void(0) onclick='return scrolly("6-艺术就是复制"),!1'>6 艺术就是复制</a><ul class=nav><li class=nav-item><a id=t61配置redissalve href=javascript:void(0) onclick='return scrolly("61-配置redis-salve"),!1'>6.1 配置redis-salve</a><ul class=nav><li class=nav-item><a id=t611salve启动日志 href=javascript:void(0) onclick='return scrolly("611-salve启动日志"),!1'>6.1.1 salve启动日志</a></li><li class=nav-item><a id=t612验证主从数据同步 href=javascript:void(0) onclick='return scrolly("612-验证主从数据同步"),!1'>6.1.2 验证主从数据同步</a></li></ul></li><li class=nav-item><a id=t62配置redissentinel href=javascript:void(0) onclick='return scrolly("62-配置redis-sentinel"),!1'>6.2 配置redis-sentinel</a><ul class=nav><li class=nav-item><a id=t621sentinel启动日志 href=javascript:void(0) onclick='return scrolly("621-sentinel启动日志"),!1'>6.2.1 sentinel启动日志</a></li><li class=nav-item><a id=t622使用rediscli查看系统信息 href=javascript:void(0) onclick='return scrolly("622-使用redis-cli查看系统信息"),!1'>6.2.2 使用redis-cli查看系统信息</a></li><li class=nav-item><a id=t623模拟主备切换 href=javascript:void(0) onclick='return scrolly("623-模拟主备切换"),!1'>6.2.3 模拟主备切换</a></li></ul></li></ul></li><li class=nav-item><a id=t7结束语 href=javascript:void(0) onclick='return scrolly("7-结束语"),!1'>7 结束语</a></li></ul></div><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></div></aside></main><div class=back-to-top><div id=back-to-top><img src=/svg/chevrons-up.svg srcset="/svg/chevrons-up.svg 500w" onclick=topFunction() class=black>
<img title src=/svg/chevrons-up-blue.svg srcset="/svg/chevrons-up-blue.svg 500w" onclick=topFunction() class=blue></div><script>let mybutton=document.getElementById("back-to-top");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>500||document.documentElement.scrollTop>500?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){window.scrollTo({top:0,behavior:"smooth"})}</script></div><script src=/js/scroll-listening.js></script></body></html>
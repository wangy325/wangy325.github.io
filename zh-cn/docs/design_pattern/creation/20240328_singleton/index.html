<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="

by Head First 设计模式

单例模式确保一个类只有一个实例，并且提供一个全局访问点。


by Dive into Design Patterns

Singleton is a creation(al) design pattern that lets you ensure
that a class has only one instance, while providing a global
access point to this instance.

"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://wangy325.github.io/zh-cn/docs/design_pattern/creation/20240328_singleton/"><meta property="og:site_name" content="xf&pl"><meta property="og:title" content="单例模式"><meta property="og:description" content="by Head First 设计模式
单例模式确保一个类只有一个实例，并且提供一个全局访问点。
by Dive into Design Patterns
Singleton is a creation(al) design pattern that lets you ensure that a class has only one instance, while providing a global access point to this instance."><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-03-28T00:00:00+08:00"><meta property="article:modified_time" content="2025-03-30T23:40:31+08:00"><title>单例模式 | xf&amp;pl</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://wangy325.github.io/zh-cn/docs/design_pattern/creation/20240328_singleton/><link rel=stylesheet href=/book.min.3cf95a1bd697b902b62eb0c72147591c0a33fb3b5f76dc80ccf10bfd26e5a29f.css integrity="sha256-PPlaG9aXuQK2LrDHIUdZHAoz+ztfdtyAzPEL/Sblop8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/zh-cn.search.min.4989a5b9c683926b5b351382a32933b4205b1cdc3ebbfbdcba8da6efe01adf70.js integrity="sha256-SYmlucaDkmtbNROCoykztCBbHNw+u/vcuo2m7+Aa33A=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-HHNKR5H8KN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HHNKR5H8KN")}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><div class=navi-bar id=navibar><div id=page-title><h2 class=book-brand><a class="flex align-center" href=/zh-cn/><span>xf&amp;pl</span></a></h2></div><div class=page-navi-col><nav><ul><li><a href=/zh-cn/docs/java/>Java</a></li><li><a href=/zh-cn/docs/design_pattern/>DP</a></li><li class=book-section-flat><a href=/zh-cn/docs/note/>Mooc</a></li><li class=book-section-flat><a href=/zh-cn/docs/snippets/>Snippets</a></li></ul><ul><li><a href=/zh-cn/posts/>Blog</a></li><li><a href=/zh-cn/archive/>Archive</a></li></ul></nav></div><div class="book-search hidden"><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/ required pattern=\S+.*>
<span class=clear_search><img src=/svg/close.svg onclick=clearInput()></span><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><script>function clearInput(){document.getElementById("book-search-input").value="";for(var e=document.getElementById("book-search-results");e.firstChild;)e.removeChild(e.firstChild)}</script><ul class=book-languages><li><a class="flex align-center"><img src=/svg/language.svg class=book-icon alt=Languages>
简体中文</a></label><ul><li><a href=https://wangy325.github.io/en/>English</a></li></ul></li></ul></div><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><ul><li><span>创建型</span><ul><li><a href=/zh-cn/docs/design_pattern/creation/20240328_singleton/ class=active>单例模式</a></li><li><a href=/zh-cn/docs/design_pattern/creation/20240326_factory/>工厂方法模式</a></li><li><a href=/zh-cn/docs/design_pattern/creation/20240326_abstract_factory/>抽象工厂模式</a></li><li><a href=/zh-cn/docs/design_pattern/creation/20240313_builder/>建造模式</a></li></ul></li><li><span>结构型</span><ul><li><a href=/zh-cn/docs/design_pattern/structure/20240321_decorator/>装饰者模式</a></li><li><a href=/zh-cn/docs/design_pattern/structure/20240401_adaptor/>适配器模式</a></li><li><a href=/zh-cn/docs/design_pattern/structure/20240401_facade/>外观模式</a></li><li><a href=/zh-cn/docs/design_pattern/structure/20181205_proxy/>代理模式</a></li></ul></li><li><span>行为模式</span><ul><li><a href=/zh-cn/docs/design_pattern/behaviour/20240329_command/>命令模式</a></li><li><a href=/zh-cn/docs/design_pattern/behaviour/20240308_observer/>观察者模式</a></li><li><a href=/zh-cn/docs/design_pattern/behaviour/20240307_strategy/>策略模式</a></li><li><a href=/zh-cn/docs/design_pattern/behaviour/20240402_template_method/>模板方法模式</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>单例模式</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><div id=toc-new><ul class=nav><li class=nav-item><a id=t模式特点 href=javascript:void(0) onclick='return scrolly("模式特点"),!1'>模式特点</a></li><li class=nav-item><a id=tUML简图 href=javascript:void(0) onclick='return scrolly("uml简图"),!1'>UML简图</a></li><li class=nav-item><a id=t实现 href=javascript:void(0) onclick='return scrolly("实现"),!1'>实现</a><ul class=nav><li class=nav-item><a id=t1典型但线程不安全实现 href=javascript:void(0) onclick='return scrolly("1-典型但线程不安全实现"),!1'>1. 典型但线程不安全实现</a></li><li class=nav-item><a id=t2提前实例化 href=javascript:void(0) onclick='return scrolly("2-提前实例化"),!1'>2. 提前实例化</a></li><li class=nav-item><a id=t3使用同步方法（重量级锁） href=javascript:void(0) onclick='return scrolly("3-使用同步方法重量级锁"),!1'>3. 使用同步方法（重量级锁）</a></li><li class=nav-item><a id=t4使用DCLDoubleCheckLocking href=javascript:void(0) onclick='return scrolly("4-使用dcl-double-check-locking"),!1'>4. 使用DCL (Double-Check-Locking)</a></li><li class=nav-item><a id=t5延迟实例化（按需加载） href=javascript:void(0) onclick='return scrolly("5-延迟实例化按需加载"),!1'>5. 延迟实例化（按需加载）</a></li><li class=nav-item><a id=t6使用枚举 href=javascript:void(0) onclick='return scrolly("6-使用枚举"),!1'>6. 使用枚举</a></li></ul></li><li class=nav-item><a id=t讨论 href=javascript:void(0) onclick='return scrolly("讨论"),!1'>讨论</a></li><li class=nav-item><a id=t参考 href=javascript:void(0) onclick='return scrolly("参考"),!1'>参考</a></li></ul></div><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></aside></header><article class="markdown book-article"><h1>单例模式</h1><div class="postmeta flex align-cneter" style=justify-content:center><div class="created flex align-cneter"><img src=/svg/calendar-event.svg class=book-icon alt>
<a title='创建者 wangy325'>2024-03-28</a></div><div class="cates flex align-center"><img src=/svg/cates.svg class=book-icon alt>
<a href=/zh-cn/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></div><div class="last-modified flex align center"><img src=/svg/edit.svg class=book-icon alt>
<a title='最后修改者 wangy | 2025-03-30'>2025-03-30</a></div></div><ul><li><p>by Head First 设计模式</p><blockquote><p>单例模式确保一个类只有一个实例，并且提供一个全局访问点。</p></blockquote></li><li><p>by Dive into Design Patterns</p><blockquote><p><strong>Singleton</strong> is a <em>creation(al)</em> design pattern that lets you ensure
that a class has only one instance, while providing a global
access point to this instance.</p></blockquote></li></ul><h3 id=模式特点>模式特点
<a class=anchor href=#%e6%a8%a1%e5%bc%8f%e7%89%b9%e7%82%b9>#</a></h3><ul><li>单例模式确保程序中一个类<strong>只有</strong>一个实例。</li><li>单例模式提供类的全局访问点。</li><li>Java实现单例需要私有构造器、静态方法和静态变量。</li><li>确定在性能和资源上的限制，再采用合适的方法来实现单例模式，以确保在多线程下的安全性。</li><li><input disabled type=checkbox> 如果使用多个类加载器，可能导致单例模式失效而出现多个实例。[例证？]</li></ul><h3 id=uml简图>UML简图
<a class=anchor href=#uml%e7%ae%80%e5%9b%be>#</a></h3><script src=/mermaid.min.js></script><script>mermaid.initialize({flowchart:{useMaxWidth:!0},theme:"light"})</script><pre class=mermaid>
classDiagram
class Singleton {
  -Singleton instance
  -Singleton() Singleton
  +getInstance()$ Singleton
}
</pre><h3 id=实现>实现
<a class=anchor href=#%e5%ae%9e%e7%8e%b0>#</a></h3><h4 id=1-典型但线程不安全实现>1. 典型但线程不安全实现
<a class=anchor href=#1-%e5%85%b8%e5%9e%8b%e4%bd%86%e7%ba%bf%e7%a8%8b%e4%b8%8d%e5%ae%89%e5%85%a8%e5%ae%9e%e7%8e%b0>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=ln> 1</span><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>INSTANCE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>            </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>INSTANCE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>典型的单例实现，但多线程下不适用。</p><h4 id=2-提前实例化>2. 提前实例化
<a class=anchor href=#2-%e6%8f%90%e5%89%8d%e5%ae%9e%e4%be%8b%e5%8c%96>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=ln> 1</span><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>INSTANCE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>它是线程安全的，因为静态变量只在类初始化时初始化。它只有一个缺点：如果是资源紧张
的情况，提前实例化有一点点的资源浪费（如果用不到的话）。</p><h4 id=3-使用同步方法重量级锁>3. 使用同步方法（重量级锁）
<a class=anchor href=#3-%e4%bd%bf%e7%94%a8%e5%90%8c%e6%ad%a5%e6%96%b9%e6%b3%95%e9%87%8d%e9%87%8f%e7%ba%a7%e9%94%81>#</a></h4><p>对方法1的改进：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=ln> 1</span><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>INSTANCE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>            </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>INSTANCE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>此方法是可行的。但是，它存在很严重的性能浪费，使用<code>synchronized</code>对方法加锁，
可能导致代码执行效率低1000倍！</p><h4 id=4-使用dcl-double-check-locking>4. 使用DCL (Double-Check-Locking)
<a class=anchor href=#4-%e4%bd%bf%e7%94%a8dcl-double-check-locking>#</a></h4><p>对方法3的改进。既然不推荐使用重量级锁，那么是否有更好的加锁方式呢？</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=ln> 1</span><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>volatile</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>INSTANCE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>Singleton</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>INSTANCE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>                    </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>INSTANCE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>DCL中使用了<code>volatile</code>关键字，这是必须的。第一次的<code>null</code>判定减少了上锁的
概率，第二次的<code>null</code>判定才是保证线程安全根本。</p><p>注意，这个方式并不一定是百分百安全的，<code>volatile</code>关键字的语义在1.4版本之前
的Java中存在bug。</p><blockquote><p>One thing to keep in mind with this pattern is that the field
needs to be <em>volatile</em> to prevent cache incoherence issues.
In fact, the Java memory model allows the publication of
partially initialized objects and this may lead in turn to
subtle bugs.</p></blockquote><h4 id=5-延迟实例化按需加载>5. 延迟实例化（按需加载）
<a class=anchor href=#5-%e5%bb%b6%e8%bf%9f%e5%ae%9e%e4%be%8b%e5%8c%96%e6%8c%89%e9%9c%80%e5%8a%a0%e8%bd%bd>#</a></h4><p>对方法2的小小优化。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=ln> 1</span><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>InstanceHolder</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>INSTANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>InstanceHolder</span><span class=p>.</span><span class=na>INSTANCE</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>与方法2的区别是，单例对象只有在调用<code>getInstance()</code>方法时，才会初始化。</p><h4 id=6-使用枚举>6. 使用枚举
<a class=anchor href=#6-%e4%bd%bf%e7%94%a8%e6%9e%9a%e4%b8%be>#</a></h4><p>枚举类只有指定的实例，并没有其他办法来创建其他实例，因此可以用来实现单例。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=ln>1</span><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>enum</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>    </span><span class=n>INSTANCE</span><span class=p>(</span><span class=s>&#34;unique&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>abbr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>    
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>abbr</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>      </span><span class=k>this</span><span class=p>.</span><span class=na>abbr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>abbr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln>9</span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=讨论>讨论
<a class=anchor href=#%e8%ae%a8%e8%ae%ba>#</a></h3><p>单例模式是一个简单的设计模式，但是可别滥用它。使用时想一想，是否一定需要
一个单例对象，才能满足需求？</p><p>单例模式实际上违法了<strong>单一职责原则</strong>：单例保证了实例的唯一性，同时还要提供
全局访问入口。</p><p>同时，单例代码使得测试工作变得麻烦。</p><p>上文提及的单例模式创建方法，实际上只有<code>early initializatin</code>和
<code>lazy initialization</code>两种，使用DCL可能会由于编译器优化存在细微的问题，
而枚举类单例的形式，是[<em>Effective Java</em>]中推荐使用的。</p><blockquote><p>不管怎样，使用枚举来实现复杂的单例，看起来很怪。</p></blockquote><p>另外，使用单例可能还会有其他一些问题：</p><ol><li>如果是在分布式环境中，基于JVM唯一的单例如何保证？</li><li>注意你的类加载器，不同的类加载器可能会导致多例。</li><li>要防止单例对象被回收。</li></ol><h3 id=参考>参考
<a class=anchor href=#%e5%8f%82%e8%80%83>#</a></h3><ol><li><a href=https://sinethneranjana.medium.com/5-ways-to-write-a-singleton-and-why-you-shouldnt-1cf078562376>Medium: 5 ways to write singleton</a></li><li><a href=https://www.baeldung.com/java-singleton>Baeldung：Singletons in Java</a></li><li><a href=https://www.baeldung.com/java-singleton-double-checked-locking>Baeldung: Double-Check-Locking with singleton</a></li></ol></article><div class=next-prev><hr><div class="page-navi flex" id=pagenavi><div class=pre-page-none>←∅</div><div class=next-page><a href=https://wangy325.github.io/zh-cn/docs/design_pattern/creation/20240326_factory/>工厂方法模式</a> →</div></div></div><section class=related><div class=rel-title>相似文章</div><div class=rel-items><a href=/zh-cn/docs/design_pattern/creation/20240326_factory/ class=related__link><div>工厂方法模式</div></a><a href=/zh-cn/docs/design_pattern/creation/20240326_abstract_factory/ class=related__link><div>抽象工厂模式</div></a><a href=/zh-cn/docs/design_pattern/structure/20240321_decorator/ class=related__link><div>装饰者模式</div></a></div><hr></section><div class=book-comments><div class=giscus-thread></div><script src=https://giscus.app/client.js data-repo=wangy325/wangy325.github.io data-repo-id=R_kgDOHhhDZg data-category=Announcements data-category-id=DIC_kwDOHhhDZs4ChbMn data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=noborder_light data-loading=lazy data-lang=zh-CN crossorigin=anonymous async></script></div><div class=copyright><hr class=cline><p>Notes and Memos by wangy325
<a href=https://creativecommons.org/licenses/by/4.0/deed.en title="Creative Commons Attribution">&copy; CC BY 4.0</a></p><p>2019-2025. Powered by
<a href=https://github.com/alex-shpak/hugo-book>Hugo Book</a>
Presented by Github.</p></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><div id=toc-new><ul class=nav><li class=nav-item><a id=t模式特点 href=javascript:void(0) onclick='return scrolly("模式特点"),!1'>模式特点</a></li><li class=nav-item><a id=tUML简图 href=javascript:void(0) onclick='return scrolly("uml简图"),!1'>UML简图</a></li><li class=nav-item><a id=t实现 href=javascript:void(0) onclick='return scrolly("实现"),!1'>实现</a><ul class=nav><li class=nav-item><a id=t1典型但线程不安全实现 href=javascript:void(0) onclick='return scrolly("1-典型但线程不安全实现"),!1'>1. 典型但线程不安全实现</a></li><li class=nav-item><a id=t2提前实例化 href=javascript:void(0) onclick='return scrolly("2-提前实例化"),!1'>2. 提前实例化</a></li><li class=nav-item><a id=t3使用同步方法（重量级锁） href=javascript:void(0) onclick='return scrolly("3-使用同步方法重量级锁"),!1'>3. 使用同步方法（重量级锁）</a></li><li class=nav-item><a id=t4使用DCLDoubleCheckLocking href=javascript:void(0) onclick='return scrolly("4-使用dcl-double-check-locking"),!1'>4. 使用DCL (Double-Check-Locking)</a></li><li class=nav-item><a id=t5延迟实例化（按需加载） href=javascript:void(0) onclick='return scrolly("5-延迟实例化按需加载"),!1'>5. 延迟实例化（按需加载）</a></li><li class=nav-item><a id=t6使用枚举 href=javascript:void(0) onclick='return scrolly("6-使用枚举"),!1'>6. 使用枚举</a></li></ul></li><li class=nav-item><a id=t讨论 href=javascript:void(0) onclick='return scrolly("讨论"),!1'>讨论</a></li><li class=nav-item><a id=t参考 href=javascript:void(0) onclick='return scrolly("参考"),!1'>参考</a></li></ul></div><script>function scrolly(e){const t=40;var n=document.getElementById(e).offsetTop;window.scrollTo({top:n+t,behaviour:"smooth"})}</script></div></aside></main><div class=back-to-top><div id=back-to-top><img src=/svg/chevrons-up.svg srcset="/svg/chevrons-up.svg 500w" onclick=topFunction() class=black>
<img title=回到顶部 src=/svg/chevrons-up-blue.svg srcset="/svg/chevrons-up-blue.svg 500w" onclick=topFunction() class=blue></div><script>let mybutton=document.getElementById("back-to-top");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>500||document.documentElement.scrollTop>500?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){window.scrollTo({top:0,behavior:"smooth"})}</script></div><script src=/js/scroll-listening.js></script></body></html>